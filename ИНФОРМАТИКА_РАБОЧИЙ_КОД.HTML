<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Python Runner + –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ (–£—á–∏—Ç–µ–ª—å/–£—á–µ–Ω–∏–∫)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–π -->
    <script src="https://cdn.jsdelivr.net/npm/split.js@1.6.5/dist/split.min.js"></script>
    
    <style>
        /* –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
        html, body {
            height: 100vh;
            overflow: hidden;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0f172a;
            color: white;
            font-family: Segoe UI, Tahoma, sans-serif;
            display: flex;
            flex-direction: column;
            padding: 12px;
            padding-top: 0;
            box-sizing: border-box;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π */
        .top-section {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 4px;
            margin-bottom: 10px;
            background: #0f172a;
            border-radius: 8px;
            padding: 8px;
            border: 1px solid #334155;
            flex-shrink: 0;
        }

        /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ */
        .top-section::-webkit-scrollbar {
            width: 8px;
        }
        
        .top-section::-webkit-scrollbar-track {
            background: #1e293b;
            border-radius: 4px;
        }
        
        .top-section::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }
        
        .top-section::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }

        .welcome-modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.95);
            z-index: 3000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px;
        }

        .welcome-content {
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            background: #1e293b;
            padding: 30px;
            border-radius: 16px;
            border: 2px solid #334155;
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
        }

        .welcome-content h2 { color: #facc15; margin-top: 0; }
        .welcome-content h3 { color: #10b981; }
        .welcome-content ul { text-align: left; }

        .close-welcome {
            background: #64748b;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
        }

        .close-welcome:hover {
            background: #475569;
            transform: scale(1.05);
        }

        .toolbar {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-bottom: 10px;
            align-items: center;
            flex-shrink: 0;
            background: #0f172a;
            padding: 8px;
            border-radius: 8px;
            border: 1px solid #334155;
            z-index: 100;
        }

        .programmer-help-btn {
            background: linear-gradient(135deg, #a855f7, #7e22ce) !important;
            min-width: 160px;
        }
        
        .programmer-help-btn:hover {
            background: linear-gradient(135deg, #9333ea, #6b21a5) !important;
            transform: scale(1.05);
        }

        /* –ö–Ω–æ–ø–∫–∏ —Ä–µ–∂–∏–º–æ–≤ –£—á–∏—Ç–µ–ª—å/–£—á–µ–Ω–∏–∫ */
        .mode-btn {
            background: #475569;
            min-width: 120px;
        }
        
        .mode-btn.teacher-active {
            background: #dc2626 !important;
            outline: 2px solid #facc15;
        }
        
        .mode-btn.student-active {
            background: #16a34a !important;
            outline: 2px solid #facc15;
        }

        .palette-row {
            display: flex;
            gap: 4px;
            margin: 0 6px 6px 6px;
        }

        .color-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            transition: transform 0.1s;
        }

        .color-btn:hover {
            transform: scale(1.1);
        }

        .color-btn.active {
            outline: 3px solid #facc15;
            box-shadow: 0 0 0 3px rgba(250,204,21,0.5);
        }

        .color-btn.drawing {
            animation: pulse 1s infinite;
        }

        .pen-size-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 6px;
            background: #475569;
            color: white;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            transition: transform 0.1s;
        }

        .pen-size-btn:hover {
            transform: scale(1.1);
            background: #64748b;
        }

        .pen-size-btn.active {
            outline: 3px solid #facc15;
            box-shadow: 0 0 0 3px rgba(250,204,21,0.5);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1.1); }
            50% { transform: scale(1.2); }
        }

        button, input, select {
            padding: 8px 12px;
            font-size: 14px;
            font-weight: bold;
            border-radius: 8px;
            border: none;
        }

        button {
            cursor: pointer;
            background: #3b82f6;
            color: white;
            position: relative;
            overflow: hidden;
        }

        button::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.3);
            transform: skewX(-20deg);
            transition: left 0.3s;
        }

        button:active::after {
            left: 100%;
        }

        button.gray { background:#64748b; }
        button.green { background:#10b981; }
        button.red { background:#ef4444; }
        button.print { background: #f59e0b; }
        button.orange { background: #ff9800; }
        button.help { background: #a855f7; }

        .code-mode-btn {
            background: #475569;
            min-width: 120px;
        }
        
        .code-mode-btn.active {
            background: #f59e0b;
            outline: 2px solid #facc15;
        }

        .video-play-btn {
            background: linear-gradient(135deg, #10b981, #059669) !important;
            padding: 8px 12px !important;
            font-size: 16px !important;
            min-width: 50px;
        }

        .video-play-btn:hover {
            background: linear-gradient(135deg, #059669, #047857) !important;
            transform: scale(1.05);
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–º–æ—â–∏ –ø—Ä–æ–≥—Ä–∞–º–º–µ—Ä–∞ */
        .programmer-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.98);
            z-index: 4000;
            align-items: center;
            justify-content: center;
        }

        .programmer-modal.show {
            display: flex;
        }

        .programmer-content {
            background: #1e293b;
            padding: 30px;
            border-radius: 16px;
            border: 2px solid #a855f7;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .programmer-content h3 {
            color: #a855f7;
            margin-top: 0;
            font-size: 24px;
        }

        .function-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .function-btn {
            background: #334155;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            flex: 1;
            min-width: 140px;
            text-align: center;
        }

        .function-btn:hover {
            background: #475569;
            transform: scale(1.05);
        }

        .function-btn.active {
            background: #a855f7;
            box-shadow: 0 0 15px #a855f7;
        }

        .function-description {
            background: #0f172a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-family: Consolas, monospace;
            font-size: 16px;
            color: #e5e7eb;
            border-left: 4px solid #a855f7;
        }

        .function-code {
            background: #020617;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-family: Consolas, monospace;
            font-size: 16px;
            color: #e5e7eb;
            white-space: pre-wrap;
            border: 1px solid #a855f7;
        }

        .programmer-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∞–Ω–∏–º–∞—Ü–∏–∏ */
        .animation-indicator {
            background: #ff9800;
            color: #000;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-left: 10px;
            animation: pulse 1.5s infinite;
        }

        .animation-indicator .key-hint {
            background: #000;
            color: #ff9800;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        #taskImage {
            max-width: 100%;
            max-height: 240px;
            display: none;
            margin-bottom: 10px;
            border-radius: 8px;
            border: 2px solid #334155;
            transform: scale(1.1);
            transform-origin: top left;
        }

        #taskText {
            display: none;
            margin-bottom: 10px;
            padding: 12px;
            background: #1e293b;
            border-radius: 8px;
            border: 2px solid #334155;
            white-space: pre-wrap;
            font-family: Consolas, monospace;
            font-size: 18px;
            max-height: 240px;
            overflow-y: auto;
        }

        #taskText .number {
            color: #ef4444;
            font-weight: bold;
            background: rgba(239,68,68,0.1);
            padding: 1px 3px;
            border-radius: 3px;
        }

        .print-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 90vw;
            max-height: 85vh;
            width: 600px;
            height: 70vh;
            padding: 25px;
            background: #1e293b;
            border-radius: 16px;
            border: 2px solid #334155;
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
        }

        .print-checkboxes {
            max-height: 450px;
            overflow-y: auto;
            background: #0f172a;
            border-radius: 8px;
            padding: 12px;
            border: 1px solid #334155;
        }

        .print-task-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            margin: 4px 0;
            background: #1e293b;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .print-task-item:hover {
            background: #334155;
        }

        .print-task-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #f59e0b;
        }

        .answer-section {
            cursor: pointer;
            margin-top: 12px;
            padding: 8px;
            background: #1e293b;
            border-radius: 8px;
            border: 2px solid #334155;
            font-size: 16px;
            flex-shrink: 0;
        }

        .answer-section:hover {
            background: #334155;
        }

        #answerInput {
            width: 100%;
            margin-top: 12px;
            margin-bottom: 12px;
            font-size: 18px;
            padding: 10px;
            border-radius: 8px;
            display: none;
            flex-shrink: 0;
        }

        .task-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
            flex-wrap: wrap;
            flex-shrink: 0;
            background: #0f172a;
            padding: 8px;
            border-radius: 8px;
            border: 1px solid #334155;
        }

        .task-controls label {
            font-size: 14px;
            user-select: none;
        }

        .solved-container {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: #1e293b;
            border-radius: 8px;
            border: 2px solid #334155;
            transition: all 0.3s;
        }

        .solved-container.solved {
            background: linear-gradient(135deg, #10b981, #059669) !important;
            border-color: #34d399 !important;
            box-shadow: 0 0 20px rgba(16,185,129,0.5);
            animation: glow 2s infinite;
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(16,185,129,0.5); }
            50% { box-shadow: 0 0 30px rgba(16,185,129,0.8); }
        }

        /* ========== –ö–û–ù–¢–ï–ô–ù–ï–† –° –†–ê–ó–î–ï–õ–ò–¢–ï–õ–ï–ú ========== */
        .main-container {
            display: flex;
            flex-direction: row;
            width: 100%;
            flex: 1;
            min-height: 0;
            gap: 10px;
        }

        .split-container {
            display: flex;
            flex-direction: row;
            height: 100%;
            gap: 0;
            min-height: 0;
            flex: 1;
        }

        /* –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å (–∫–æ–¥) */
        .code-panel {
            background: #020617;
            border-radius: 10px 0 0 10px;
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
            min-height: 0;
        }

        .code-panel textarea {
            width: 100%;
            border-radius: 10px 0 0 10px;
            border: none;
            padding: 14px;
            font-family: Consolas, monospace;
            font-size: 20px;
            line-height: 1.5;
            background: #020617;
            color: #e5e7eb;
            resize: none;
            height: 100% !important;
            min-height: 0;
            box-sizing: border-box;
            overflow-y: auto !important;
        }

        /* –°—Ä–µ–¥–Ω—è—è –ø–∞–Ω–µ–ª—å (–≤—ã–≤–æ–¥) */
        .output-panel {
            background: #020617;
            border-radius: 0 10px 10px 0;
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
            min-height: 0;
        }

        #output {
            width: 100%;
            border-radius: 0 10px 10px 0;
            border: none;
            padding: 14px;
            font-family: Consolas, monospace;
            font-size: 20px;
            line-height: 1.5;
            background: #020617;
            color: #22c55e;
            white-space: pre-wrap;
            overflow-y: auto !important;
            height: 100% !important;
            min-height: 0;
            box-sizing: border-box;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –≤ –∞–Ω–∏–º–∞—Ü–∏–∏ - –æ—Ä–∞–Ω–∂–µ–≤—ã–µ */
        #output .animation-comment {
            color: #ff8c00 !important;
            font-style: italic;
        }

        .comment-highlight-animation {
            color: #ff8c00 !important;
            font-style: italic;
        }

        /* –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å */
        .gutter {
            cursor: col-resize;
            background: #334155;
            width: 6px;
            margin: 0;
            border-radius: 3px;
            transition: background 0.2s;
        }

        .gutter:hover {
            background: #facc15;
        }

        .gutter.gutter-horizontal {
            cursor: col-resize;
        }

        /* –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å (—Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á) */
        .task-list-panel {
            background: #1e293b;
            border-radius: 10px;
            border: 2px solid #334155;
            display: flex;
            flex-direction: column;
            height: 100% !important;
            min-height: 0;
            box-sizing: border-box;
            overflow: hidden;
            width: 280px;
            flex-shrink: 0;
        }

        .task-list-header {
            padding: 12px;
            background: #0f172a;
            border-bottom: 1px solid #334155;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            flex-shrink: 0;
        }

        .task-list-header button {
            padding: 6px 10px;
            font-size: 12px;
            background: #334155;
        }

        .task-list-header button.active {
            background: #3b82f6;
        }

        .task-list-items {
            flex: 1;
            min-height: 0;
            overflow-y: auto;
            padding: 8px;
        }

        .task-list-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 10px;
            margin-bottom: 4px;
            background: #0f172a;
            border-radius: 6px;
            border-left: 4px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }

        .task-list-item:hover {
            background: #334155;
        }

        .task-list-item.selected {
            border-left-color: #facc15;
            background: #2d3a4f;
        }

        .task-list-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: #10b981;
            cursor: pointer;
            flex-shrink: 0;
        }

        .task-star {
            cursor: pointer;
            font-size: 18px;
            color: #64748b;
            transition: color 0.2s;
            flex-shrink: 0;
        }

        .task-star.favorite {
            color: #facc15;
        }

        .task-title {
            flex: 1;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            min-width: 0;
        }

        .task-status {
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 4px;
            flex-shrink: 0;
        }

        .task-status.solved {
            background: #10b981;
        }

        .task-status.unsolved {
            background: #64748b;
        }

        #drawCanvas {
            position: fixed;
            inset: 0;
            z-index: 1000;
            pointer-events: none;
        }

        .error { color:#ef4444; }

        #taskFilter {
            background: #1e293b;
            color: white;
            padding: 8px 12px;
        }

        #videoUrl {
            background: #1e293b;
            color: white;
            padding: 6px 10px;
            font-size: 13px;
            width: 220px;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤–∏–¥–µ–æ */
        #videoModal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.98);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        #videoModal.show {
            display: flex;
        }

        .modal-video-container {
            position: relative;
            width: 90vw;
            max-width: 1200px;
            height: 70vh;
            max-height: 700px;
        }

        #modalVideo {
            width: 100%;
            height: 100%;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
        }

        .controls {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            gap: 15px;
            z-index: 10;
        }

        .fullscreen-btn, .close-modal {
            background: #64748b !important;
            backdrop-filter: blur(10px);
            border: none;
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .fullscreen-btn:hover, .close-modal:hover {
            background: #475569 !important;
            transform: scale(1.05);
        }

        /* –î–∏–∞–ª–æ–≥ –ø–µ—á–∞—Ç–∏ */
        #printDialog {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.95);
            z-index: 2500;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .print-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* –î–∏–∞–ª–æ–≥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è */
        .save-dialog {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.95);
            z-index: 3500;
            align-items: center;
            justify-content: center;
        }

        .save-dialog.show {
            display: flex;
        }

        .save-content {
            background: #1e293b;
            padding: 30px;
            border-radius: 16px;
            border: 2px solid #334155;
            max-width: 400px;
            width: 90%;
        }

        .save-content input {
            width: 100%;
            margin: 15px 0;
            padding: 12px;
            background: #0f172a;
            color: white;
            border: 1px solid #334155;
        }

        .save-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        /* –ò–Ω—Ñ–æ-–ø–∞–Ω–µ–ª—å –∑–∞–¥–∞—á–∏ */
        .task-info-panel {
            background: #1e293b;
            padding: 12px 16px;
            margin-bottom: 10px;
            border-radius: 8px;
            border: 2px solid #334155;
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
            flex-shrink: 0;
        }

        .task-info-title {
            font-size: 16px;
            font-weight: bold;
            color: #facc15;
        }

        .task-info-analog {
            background: #334155;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 14px;
            color: #94a3b8;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .task-info-analog a {
            color: #3b82f6;
            text-decoration: none;
        }

        .task-info-analog a:hover {
            text-decoration: underline;
        }

        .task-info-video {
            background: #059669;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .task-info-video a {
            color: white;
            text-decoration: none;
        }

        .task-info-video a:hover {
            text-decoration: underline;
        }

        /* –ù–û–í–û–ï: –ø–æ–ª–µ –¥–ª—è —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ñ–∞–π–ª */
        .task-info-file {
            background: #2563eb;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            max-width: 300px;
        }

        .task-info-file a {
            color: white !important;
            text-decoration: none;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 200px;
        }

        .task-info-file a:hover {
            text-decoration: underline;
        }

        .task-info-file button {
            background: #1e293b !important;
            color: white;
            padding: 2px 8px;
            font-size: 12px;
            border-radius: 12px;
        }

        .task-info-file button:hover {
            background: #334155 !important;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ –ø–æ —Å—Å—ã–ª–∫–µ */
        .file-load-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.98);
            z-index: 4500;
            align-items: center;
            justify-content: center;
        }

        .file-load-modal.show {
            display: flex;
        }

        .file-load-content {
            background: #1e293b;
            padding: 30px;
            border-radius: 16px;
            border: 2px solid #2563eb;
            max-width: 600px;
            width: 90%;
        }

        .file-load-content h3 {
            color: #2563eb;
            margin-top: 0;
        }

        .file-load-content input {
            width: 100%;
            padding: 12px;
            margin: 15px 0;
            background: #0f172a;
            color: white;
            border: 1px solid #334155;
            border-radius: 8px;
            font-family: Consolas, monospace;
        }

        .file-load-content textarea {
            width: 100%;
            height: 200px;
            background: #0f172a;
            color: #e5e7eb;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 12px;
            font-family: Consolas, monospace;
            margin-bottom: 15px;
        }

        .file-load-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .file-example-btn {
            background: #334155;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            margin-left: 10px;
        }

        .file-example-btn:hover {
            background: #475569;
        }

        /* –°–µ–ª–µ–∫—Ç–æ—Ä –∑–∞–¥–∞—á —Å GitHub */
        .github-tasks-selector {
            background: #1e293b;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .github-tasks-selector select {
            background: #0f172a;
            color: white;
            border: 1px solid #334155;
            padding: 8px;
            border-radius: 8px;
            min-width: 200px;
            flex: 1;
        }

        .load-task-btn {
            background: #3b82f6 !important;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è */
        .confirm-dialog {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.95);
            z-index: 5000;
            align-items: center;
            justify-content: center;
        }

        .confirm-dialog.show {
            display: flex;
        }

        .confirm-content {
            background: #1e293b;
            padding: 30px;
            border-radius: 16px;
            border: 2px solid #facc15;
            max-width: 500px;
        }

        .confirm-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        @media print {
            body * { visibility: hidden; }
            .print-content, .print-content * { visibility: visible; }
            .print-content { 
                position: absolute; left: 0; top: 0; width: 100%; 
                background: white; color: black; padding: 20px 30px; font-family: Arial, sans-serif;
                font-size: 16px; line-height: 1.6;
            }
            .print-task { page-break-inside: avoid; margin-bottom: 40px; }
            .print-task a { color: #1e293b; text-decoration: underline; }
            button, input, .toolbar, #printDialog, #printContent > style, .task-list-panel { display: none !important; }
        }
.welcome-content table {
    width: 100%;
    border-collapse: collapse;
    margin: 10px 0;
    font-size: 14px;
}
.welcome-content td {
    padding: 8px 12px;
    border-bottom: 1px solid #334155;
}
.welcome-content td:first-child {
    color: #facc15;
    font-weight: bold;
    width: 140px;
}
.welcome-content h4 {
    margin: 0 0 10px 0;
    font-size: 18px;
}
    </style>
</head>
<body>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è (–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è) -->
<div id="welcomeModal" class="welcome-modal" style="display: none;">
    <div class="welcome-content">
        <h2>üéØ Python Runner + –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –∫–æ–¥–∞</h2>
        
        <!-- –ò–ù–°–¢–†–£–ö–¶–ò–Ø –î–õ–Ø –£–ß–ï–ù–ò–ö–ê (–î–û–ë–ê–í–õ–Ø–ï–ú –°–Æ–î–ê) -->
        <div style="background: #0f172a; border-radius: 12px; padding: 20px; margin: 20px 0; border-left: 5px solid #10b981;">
            <h3 style="color: #10b981; margin-top: 0;">üìò –ò–ù–°–¢–†–£–ö–¶–ò–Ø –î–õ–Ø –£–ß–ï–ù–ò–ö–ê</h3>
            
            <!-- –í–ò–î–ï–û –†–ï–ñ–ò–ú -->
            <div style="background: #1e293b; border-radius: 8px; padding: 15px; margin-bottom: 20px; border-left: 5px solid #ef4444;">
                <h4 style="color: #ef4444; margin-top: 0;">üé¨ –†–ï–ñ–ò–ú –ü–†–û–°–ú–û–¢–†–ê –í–ò–î–ï–û</h4>
                <table style="width: 100%;">
                    <tr><td style="width: 200px;">–í—Å—Ç–∞–≤–∫–∞ —Å—Å—ã–ª–∫–∏</td><td>–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ YouTube/Rutube –≤ –ø–æ–ª–µ üîó YouTube/Rutube</td></tr>
                    <tr><td>–ö–Ω–æ–ø–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è</td><td>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É ‚ñ∂Ô∏è —Ä—è–¥–æ–º —Å –ø–æ–ª–µ–º –≤–≤–æ–¥–∞</td></tr>
                    <tr><td>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</td><td>–ü—Ä–æ–±–µ–ª - –ø–∞—É–∑–∞, Esc - –≤—ã—Ö–æ–¥, F11 - –ø–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω, ‚Üê‚Üí - –ø–µ—Ä–µ–º–æ—Ç–∫–∞</td></tr>
                </table>
            </div>
            
            <!-- –†–ò–°–û–í–ê–ù–ò–ï -->
            <div style="background: #1e293b; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                <h4 style="color: #facc15; margin-top: 0;">üé® –†–ï–ñ–ò–ú –†–ò–°–û–í–ê–ù–ò–Ø</h4>
                <table style="width: 100%;">
                    <tr><td>–í–∫–ª—é—á–µ–Ω–∏–µ</td><td>–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç –∏–ª–∏ —Ç–æ–ª—â–∏–Ω—É –ø–µ—Ä–∞ –≤ –ø–∞–ª–∏—Ç—Ä–µ</td></tr>
                    <tr><td>–†–∏—Å–æ–≤–∞–Ω–∏–µ</td><td>–ó–∞–∂–º–∏—Ç–µ –ª–µ–≤—É—é –∫–Ω–æ–ø–∫—É –º—ã—à–∏ –∏ –¥–≤–∏–≥–∞–π—Ç–µ –∫—É—Ä—Å–æ—Ä</td></tr>
                    <tr><td>–û—Ç–º–µ–Ω–∞</td><td>–ö–Ω–æ–ø–∫–∞ ‚Ü© Undo –∏–ª–∏ Ctrl+Z</td></tr>
                    <tr><td>–û—á–∏—Å—Ç–∏—Ç—å</td><td>–ö–Ω–æ–ø–∫–∞ üßπ –û—á–∏—Å—Ç–∏—Ç—å</td></tr>
                    <tr><td>–í—ã—Ö–æ–¥</td><td>–ù–∞–∂–º–∏—Ç–µ Esc</td></tr>
                </table>
                <p style="color: #ef4444; margin-top: 10px;"><strong>‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:</strong> –í–æ –≤—Ä–µ–º—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º–∏!</p>
            </div>
            
            <!-- –ê–ù–ò–ú–ê–¶–ò–Ø –ö–û–î–ê -->
            <div style="background: #1e293b; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                <h4 style="color: #f59e0b; margin-top: 0;">üé¨ –ê–ù–ò–ú–ê–¶–ò–Ø –û–ë–™–Ø–°–ù–ï–ù–ò–Ø –ö–û–î–ê</h4>
                <table style="width: 100%;">
                    <tr><td>–ó–∞–ø—É—Å–∫</td><td>–ö–Ω–æ–ø–∫–∞ üé¨ –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –∫–æ–¥–∞</td></tr>
                    <tr><td>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</td><td>–ù–∞–∂–º–∏—Ç–µ –ü—Ä–æ–±–µ–ª</td></tr>
                    <tr><td>–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</td><td>–ù–∞–∂–º–∏—Ç–µ Esc</td></tr>
                </table>
                <p>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ–¥—Å–≤–µ—á–∏–≤–∞—é—Ç—Å—è <span style="color: #ff8c00;">–æ—Ä–∞–Ω–∂–µ–≤—ã–º</span></p>
            </div>
            
            <!-- –°–ü–ò–°–û–ö –ó–ê–î–ê–ß -->
            <div style="background: #1e293b; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                <h4 style="color: #3b82f6; margin-top: 0;">üìã –†–ê–ë–û–¢–ê –°–û –°–ü–ò–°–ö–û–ú –ó–ê–î–ê–ß</h4>
                <table style="width: 100%;">
                    <tr><td>–í—ã–±–æ—Ä –∑–∞–¥–∞—á–∏</td><td>–ö–ª–∏–∫–Ω–∏—Ç–µ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –≤ –ø—Ä–∞–≤–æ–π –ø–∞–Ω–µ–ª–∏</td></tr>
                    <tr><td>–†–µ—à–µ–Ω–æ</td><td>–ü–æ—Å—Ç–∞–≤—å—Ç–µ –≥–∞–ª–æ—á–∫—É ‚úÖ</td></tr>
                    <tr><td>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</td><td>–ö–ª–∏–∫–Ω–∏—Ç–µ –ø–æ –∑–≤–µ–∑–¥–æ—á–∫–µ ‚òÖ</td></tr>
                    <tr><td>–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è</td><td>–ö–Ω–æ–ø–∫–∏ –Ω–∞–¥ —Å–ø–∏—Å–∫–æ–º: –í—Å–µ, ‚úÖ –†–µ—à–µ–Ω–æ, ‚è≥ –ù–µ —Ä–µ—à–µ–Ω–æ, ‚≠ê –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</td></tr>
                </table>
            </div>
            
            <!-- –ó–ê–ì–†–£–ó–ö–ê –§–ê–ô–õ–ê -->
            <div style="background: #1e293b; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                <h4 style="color: #94a3b8; margin-top: 0;">üìÅ –ó–ê–ì–†–£–ó–ö–ê –§–ê–ô–õ–ê</h4>
                <table style="width: 100%;">
                    <tr><td>–ö–Ω–æ–ø–∫–∞</td><td>üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</td></tr>
                    <tr><td>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ</td><td>–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è file_content —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç —Ñ–∞–π–ª–∞</td></tr>
                </table>
            </div>
            
            <!-- –†–ï–ñ–ò–ú –£–ß–ï–ù–ò–ö -->
            <div style="background: #1e293b; border-radius: 8px; padding: 15px;">
                <h4 style="color: #16a34a; margin-top: 0;">üë®‚Äçüéì –†–ï–ñ–ò–ú –£–ß–ï–ù–ò–ö</h4>
                <p><strong>–î–æ—Å—Ç—É–ø–Ω–æ:</strong> –ó–∞–ø—É—Å–∫ –∫–æ–¥–∞, –∞–Ω–∏–º–∞—Ü–∏—è, —Ä–∏—Å–æ–≤–∞–Ω–∏–µ, –≤–∏–¥–µ–æ, –æ—Ç–º–µ—Ç–∫–∞ "–†–µ—à–µ–Ω–æ", –∏–∑–±—Ä–∞–Ω–Ω–æ–µ, –∏–º–ø–æ—Ä—Ç –∑–∞–¥–∞—á</p>
                <p><strong>–ù–ï –¥–æ—Å—Ç—É–ø–Ω–æ:</strong> –°–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á, –≤—Å—Ç–∞–≤–∫–∞ —É—Å–ª–æ–≤–∏–π, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, —ç–∫—Å–ø–æ—Ä—Ç</p>
            </div>
        </div>
        
              <button class="close-welcome" onclick="closeWelcome()">–ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É!</button>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–º–æ—â–∏ –ø—Ä–æ–≥—Ä–∞–º–º–µ—Ä–∞ -->
<div id="programmerModal" class="programmer-modal">
    <div class="programmer-content">
        <h3>üë®‚Äçüíª –ü–æ–º–æ—â—å –ø—Ä–æ–≥—Ä–∞–º–º–µ—Ä–∞</h3>
        
        <div class="function-selector">
            <div class="function-btn active" onclick="selectProgrammerFunction(0)">–°—É–º–º–∞ —Ü–∏—Ñ—Ä —á–∏—Å–ª–∞</div>
            <div class="function-btn" onclick="selectProgrammerFunction(1)">–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ü–∏—Ñ—Ä</div>
            <div class="function-btn" onclick="selectProgrammerFunction(2)">–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ç—É</div>
            <div class="function-btn" onclick="selectProgrammerFunction(3)">–ß–∏—Å–ª–æ –§–∏–±–æ–Ω–∞—á—á–∏</div>
            <div class="function-btn" onclick="selectProgrammerFunction(4)">–§–∞–∫—Ç–æ—Ä–∏–∞–ª</div>
            <div class="function-btn" onclick="selectProgrammerFunction(5)">–†–∞–∑–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –º–Ω–æ–∂–∏—Ç–µ–ª–∏</div>
        </div>
        
        <div id="functionDescription" class="function-description">
            –°—É–º–º–∞ —Ü–∏—Ñ—Ä —á–∏—Å–ª–∞ - –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∑–∞–¥–∞—á–∞. –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—É–º–º—É –µ–≥–æ —Ü–∏—Ñ—Ä.
        </div>
        
        <div id="functionCode" class="function-code">
            def sum_digits(n):\n    # –°—É–º–º–∞ —Ü–∏—Ñ—Ä —á–∏—Å–ª–∞\n    total = 0\n    n = abs(n)  # –ë–µ—Ä–µ–º –º–æ–¥—É–ª—å —á–∏—Å–ª–∞\n    while n > 0:\n        total += n % 10  # –î–æ–±–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Ü–∏—Ñ—Ä—É\n        n //= 10  # –£–±–∏—Ä–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Ü–∏—Ñ—Ä—É\n    return total
        </div>
        
        <div class="programmer-buttons">
            <button class="green" onclick="runProgrammerFunction()">‚ñ∂ –ó–∞–ø—É—Å—Ç–∏—Ç—å</button>
            <button class="orange" onclick="animateProgrammerFunction()">üé¨ –ê–Ω–∏–º–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="gray" onclick="copyProgrammerCode()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</button>
            <button class="red" onclick="closeProgrammerModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ –ø–æ —Å—Å—ã–ª–∫–µ -->
<div id="fileLoadModal" class="file-load-modal">
    <div class="file-load-content">
        <h3>üìÅ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –ø–æ —Å—Å—ã–ª–∫–µ</h3>
        
        <div style="margin-bottom: 15px;">
            <label style="color: #94a3b8;">–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∞–π–ª:</label>
            <div style="display: flex; gap: 5px;">
                <input type="text" id="fileUrlInput" placeholder="https://raw.githubusercontent.com/... –∏–ª–∏ https://drive.google.com/..." style="flex: 1;">
                <span class="file-example-btn" onclick="setExampleUrl()">–ü—Ä–∏–º–µ—Ä</span>
            </div>
        </div>
        
        <div style="margin-bottom: 15px;">
            <label style="color: #94a3b8;">–ò–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ:</label>
            <textarea id="fileContentInput" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –∑–¥–µ—Å—å..."></textarea>
        </div>
        
        <div style="margin-bottom: 15px; background: #0f172a; padding: 10px; border-radius: 8px;">
            <label style="color: #94a3b8;">–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∫–æ–¥–µ:</label>
            <pre style="color: #e5e7eb; font-family: Consolas; font-size: 12px; margin: 5px 0;">
# –í Python –∫–æ–¥–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è file_content –¥–æ—Å—Ç—É–ø–Ω–∞
lines = file_content.split('\n')
first_line = lines[0] if lines else ""

# –ü–æ–∏—Å–∫ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π C
for k in range(1, 100):
    if 'C'*k in first_line:
        print(f"–ù–∞–π–¥–µ–Ω–æ {k} –±—É–∫–≤ C")</pre>
        </div>
        
        <div class="file-load-buttons">
            <button class="green" onclick="loadFileFromUrl()">üåê –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ —Å—Å—ã–ª–∫–µ</button>
            <button class="green" onclick="usePastedFileContent()">üìù –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç</button>
            <button class="red" onclick="closeFileLoadModal()">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
<div id="confirmDialog" class="confirm-dialog">
    <div class="confirm-content">
        <h3 style="color: #facc15;">‚ö†Ô∏è –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h3>
        <p id="confirmMessage">–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ?</p>
        <div class="confirm-buttons">
            <button class="green" id="confirmYes">–î–∞</button>
            <button class="red" id="confirmNo">–ù–µ—Ç</button>
        </div>
    </div>
</div>

<!-- –í–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π -->
<div class="top-section">
    <div class="toolbar">
        <!-- –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞ -->
        <button class="mode-btn student-active" id="studentModeBtn" onclick="setMode('student')">üë®‚Äçüéì –£—á–µ–Ω–∏–∫</button>
        <button class="mode-btn" id="teacherModeBtn" onclick="setMode('teacher')">üë®‚Äçüè´ –£—á–∏—Ç–µ–ª—å</button>
        
        <!-- –ö–Ω–æ–ø–∫–∏ —É—á–∏—Ç–µ–ª—è (–±—É–¥—É—Ç —Å–∫—Ä—ã—Ç—ã –≤ —Ä–µ–∂–∏–º–µ —É—á–µ–Ω–∏–∫–∞) -->
        <span id="teacherButtons" style="display: inline;">
            <button onclick="pasteImage()">üìã –£—Å–ª–æ–≤–∏–µ (img)</button>
            <button onclick="pasteText()">üìÑ –£—Å–ª–æ–≤–∏–µ (—Ç–µ–∫—Å—Ç)</button>
            <button class="gray" onclick="showSaveDialog()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button class="gray" onclick="exportTasks()">‚¨á –≠–∫—Å–ø–æ—Ä—Ç</button>
            <button class="print" onclick="showPrintDialog()">üñ®Ô∏è –ü–µ—á–∞—Ç—å</button>
        </span>
        
        <!-- –û–±—â–∏–µ –∫–Ω–æ–ø–∫–∏ -->
        <button class="gray" onclick="importTasks()">‚¨Ü –ò–º–ø–æ—Ä—Ç</button>
        <button class="help" onclick="showWelcomeModal()">‚ùì –ü–æ–º–æ—â—å</button>
        <button class="programmer-help-btn" onclick="showProgrammerModal()">üë®‚Äçüíª –ü–æ–º–æ—â—å –ø—Ä–æ–≥—Ä–∞–º–º–µ—Ä–∞</button>

        <!-- –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞ –∫–æ–¥–∞ -->
        <button class="code-mode-btn" id="codeModeNoComments" onclick="setCodeMode('noComments')">üìù –ë–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</button>
        <button class="code-mode-btn active" id="codeModeWithComments" onclick="setCodeMode('withComments')">üìù –° –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏</button>

        <button class="green" onclick="runPython()">‚ñ∂ Run</button>
        <button class="orange" onclick="startCodeAnimation()">üé¨ –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –∫–æ–¥–∞</button>
        <button class="gray" onclick="copyCode()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</button>
        <button class="green" onclick="runWithFile()">üìÅ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å —Ñ–∞–π–ª–æ–º</button>
        
        <div class="palette-row">
            <button class="color-btn" style="background:#ffff00" onclick="setColor('#ffff00')"></button>
            <button class="color-btn" style="background:#ff0000" onclick="setColor('#ff0000')"></button>
            <button class="color-btn" style="background:#00ff00" onclick="setColor('#00ff00')"></button>
            <button class="color-btn" style="background:#0000ff" onclick="setColor('#0000ff')"></button>
            <button class="color-btn" style="background:#ffffff" onclick="setColor('#ffffff')"></button>
            <button class="pen-size-btn" onclick="setPenSize(2)">‚îÄ</button>
            <button class="pen-size-btn" onclick="setPenSize(6)">‚îÅ</button>
            <button class="pen-size-btn" onclick="setPenSize(12)">‚¨§</button>
        </div>
        
        <button class="gray" onclick="undo()">‚Ü© Undo</button>
        <button class="red" onclick="clearCanvas()">üßπ –û—á–∏—Å—Ç–∏—Ç—å</button>
        
        <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∞–Ω–∏–º–∞—Ü–∏–∏ (—Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
        <div id="animationIndicator" class="animation-indicator" style="display: none;">
            <span>üé¨ –ê–Ω–∏–º–∞—Ü–∏—è</span>
            <span class="key-hint">–õ—é–±–∞—è –∫–ª–∞–≤–∏—à–∞ ‚Üí –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å</span>
            <span class="key-hint">Esc ‚Üí –≤—ã—Ö–æ–¥</span>
        </div>
    </div>

    <!-- –°–µ–ª–µ–∫—Ç–æ—Ä –∑–∞–¥–∞—á —Å GitHub -->
    <div class="github-tasks-selector">
        <select id="githubTaskSelect">
            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞—á—É —Å GitHub --</option>
<option value="https://raw.githubusercontent.com/gannamath2026/trenager_programs/main/informatika1.json">–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞ 1</option>
<option value="https://raw.githubusercontent.com/gannamath2026/trenager_programs/main/informatika2.json">–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞ 2</option>
<option value="https://raw.githubusercontent.com/gannamath2026/trenager_programs/main/informatika9.json">–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞ 9</option>
<option value="https://raw.githubusercontent.com/gannamath2026/trenager_programs/main/informatika13.json">–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞ 13</option>
<option value="https://raw.githubusercontent.com/gannamath2026/trenager_programs/main/informatika17.json">–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞ 17</option>
<option value="https://raw.githubusercontent.com/GannaMath2026/trenager_programs/main/informatika24.json">–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞ 24</option>

        </select>
        <button class="load-task-btn" onclick="loadGithubTask()">üì• –ó–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞–¥–∞—á—É</button>
    </div>

    <div class="task-controls">
        <div style="display: flex; gap: 8px; align-items: center;">
            <input id="videoUrl" placeholder="üîó YouTube/Rutube" oninput="updateVideo()">
            <button id="videoPlayBtn" class="video-play-btn" onclick="playVideo()" style="display: none;">‚ñ∂Ô∏è</button>
        </div>
        <div id="solvedContainer" class="solved-container">
            <input type="checkbox" id="solvedCheckbox">
            <label for="solvedCheckbox">‚úÖ –†–µ—à–µ–Ω–æ</label>
        </div>
        <button class="gray" onclick="showFileLoadModal()">üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</button>
    </div>

    <!-- –ò–Ω—Ñ–æ-–ø–∞–Ω–µ–ª—å –∑–∞–¥–∞—á–∏ —Å –ø–æ–ª–µ–º –¥–ª—è —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ñ–∞–π–ª -->
    <div id="taskInfoPanel" class="task-info-panel" style="display: none;">
        <span id="taskInfoTitle" class="task-info-title"></span>
        <span id="taskInfoAnalog" class="task-info-analog" style="display: none;"></span>
        <span id="taskInfoVideo" class="task-info-video" style="display: none;"></span>
        <!-- –ù–û–í–û–ï –ü–û–õ–ï –¥–ª—è —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ñ–∞–π–ª -->
        <span id="taskInfoFile" class="task-info-file" style="display: none;">
            <span>üìÅ</span>
            <a href="#" id="fileLink" target="_blank"></a>
            <button class="gray" onclick="showFileLoadModal()">‚¨á –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
        </span>
    </div>

    <img id="taskImage">
    <div id="taskText"></div>

    <div class="answer-section" onclick="toggleAnswer()" id="answerToggle">
        üëÅÔ∏è –û—Ç–≤–µ—Ç
    </div>
    <input id="answerInput" placeholder="–í–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç">
</div>

<!-- –î–∏–∞–ª–æ–≥ –ø–µ—á–∞—Ç–∏ -->
<div id="printDialog" class="print-controls" style="display: none;">
    <h3 style="margin: 0 0 20px 0; color: #facc15; text-align: center;">üñ®Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞—á–∏ –¥–ª—è –ø–µ—á–∞—Ç–∏</h3>
    <div class="print-checkboxes" id="printCheckboxes"></div>
    <div class="print-buttons">
        <button class="green" onclick="printSelectedTasks()">üñ®Ô∏è –ü–µ—á–∞—Ç–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ</button>
        <button class="gray" onclick="closePrintDialog()">‚ùå –û—Ç–º–µ–Ω–∞</button>
        <button class="gray" onclick="selectAllForPrint()">‚úÖ –í—ã–±—Ä–∞—Ç—å –≤—Å–µ</button>
        <button class="gray" onclick="deselectAllForPrint()">‚ùå –°–Ω—è—Ç—å –≤—Å–µ</button>
    </div>
</div>

<!-- –î–∏–∞–ª–æ–≥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è -->
<div id="saveDialog" class="save-dialog">
    <div class="save-content">
        <h3 style="color: #facc15; margin-top: 0;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–¥–∞—á—É</h3>
        <input type="text" id="saveTaskName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏">
        <input type="text" id="saveFileUrl" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∞–π–ª (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" style="margin-top: 10px;">
        <div class="save-buttons">
            <button class="green" onclick="saveTaskWithName()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button class="gray" onclick="saveAsNewTask()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ –Ω–æ–≤—É—é</button>
            <button class="red" onclick="closeSaveDialog()">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>
</div>

<!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–º -->
<div class="main-container">
    <div class="split-container" id="splitContainer">
        <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –∫–æ–¥–æ–º -->
        <div class="code-panel" id="codePanel">
            <textarea id="code"></textarea>
        </div>
        
        <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –≤—ã–≤–æ–¥–æ–º -->
        <div class="output-panel" id="outputPanel">
            <div id="output">Python –≥–æ—Ç–æ–≤.</div>
        </div>
    </div>
    
    <!-- –ü–∞–Ω–µ–ª—å —Å–ø–∏—Å–∫–∞ –∑–∞–¥–∞—á —Å–ø—Ä–∞–≤–∞ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞) -->
    <div class="task-list-panel">
        <div class="task-list-header">
            <button onclick="filterTaskList('all')" id="filterAllBtn" class="active">–í—Å–µ</button>
            <button onclick="filterTaskList('solved')" id="filterSolvedBtn">‚úÖ –†–µ—à–µ–Ω–æ</button>
            <button onclick="filterTaskList('unsolved')" id="filterUnsolvedBtn">‚è≥ –ù–µ —Ä–µ—à–µ–Ω–æ</button>
            <button onclick="filterTaskList('favorite')" id="filterFavoriteBtn">‚≠ê –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
            <button onclick="filterTaskList('unfavorite')" id="filterUnfavoriteBtn">‚òÜ –ù–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
        </div>
        <div id="taskListItems" class="task-list-items"></div>
    </div>
</div>

<!-- –°–∫—Ä—ã—Ç—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø–µ—á–∞—Ç–∏ -->
<div id="printContent" class="print-content" style="display: none;"></div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤–∏–¥–µ–æ -->
<div id="videoModal" onclick="closeVideoModal(event)">
    <div class="modal-video-container">
        <iframe id="modalVideo" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="">
        </iframe>
        <div class="controls">
            <button class="close-modal" onclick="closeVideoModal(event)">‚úï –ó–∞–∫—Ä—ã—Ç—å</button>
            <button class="fullscreen-btn" onclick="toggleFullscreen(event)">‚õ∂ –ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω</button>
        </div>
    </div>
</div>

<canvas id="drawCanvas" width="1098" height="836"></canvas>
<input type="file" id="importFile" accept=".json" hidden="">

<script>
/* ================= –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ================= */
let pyodide, ready = false;
let taskTextGlobal = "";
let current = -1;
let currentTaskData = null;
let tasks = [];
let printCheckboxes = {};
let currentFilter = 'all';
let penSize = 4;
let codeMode = 'withComments'; // 'withComments' –∏–ª–∏ 'noComments'

// –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
let loadedFileContent = "";
let loadedFileName = "";

// –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã: 'student' –∏–ª–∏ 'teacher'
let currentMode = 'student';

/* ================= –ü–ï–†–ï–ú–ï–ù–ù–´–ï –î–õ–Ø –ê–ù–ò–ú–ê–¶–ò–ò ================= */
let animationActive = false;
let animationLines = [];
let currentAnimLine = 0;
let animationSpeed = 20; // –º—Å –Ω–∞ —Å–∏–º–≤–æ–ª
let animationInterval = null;
let lineElement = null;
let currentLineText = '';
let currentLineIndex = 0;
let animationFullCode = ''; // –ü–æ–ª–Ω—ã–π –∫–æ–¥ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏

/* ================= –ü–ï–†–ï–ú–ï–ù–ù–´–ï –î–õ–Ø –ü–û–ú–û–©–ò –ü–†–û–ì–†–ê–ú–ú–ï–†–ê ================= */
let programmerFunctions = [
    {
        name: "–°—É–º–º–∞ —Ü–∏—Ñ—Ä —á–∏—Å–ª–∞",
        description: "–°—É–º–º–∞ —Ü–∏—Ñ—Ä —á–∏—Å–ª–∞ - –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∑–∞–¥–∞—á–∞. –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—É–º–º—É –µ–≥–æ —Ü–∏—Ñ—Ä.",
        code: "def sum_digits(n):\n    # –°—É–º–º–∞ —Ü–∏—Ñ—Ä —á–∏—Å–ª–∞\n    total = 0\n    n = abs(n)  # –ë–µ—Ä–µ–º –º–æ–¥—É–ª—å —á–∏—Å–ª–∞\n    while n > 0:\n        total += n % 10  # –î–æ–±–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Ü–∏—Ñ—Ä—É\n        n //= 10  # –£–±–∏—Ä–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Ü–∏—Ñ—Ä—É\n    return total",
        test: "print(sum_digits(12345))  # –î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ 15"
    },
    {
        name: "–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ü–∏—Ñ—Ä",
        description: "–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ü–∏—Ñ—Ä —á–∏—Å–ª–∞. –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –µ–≥–æ —Ü–∏—Ñ—Ä.",
        code: "def product_digits(n):\n    # –ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ü–∏—Ñ—Ä —á–∏—Å–ª–∞\n    n = abs(n)\n    if n == 0:\n        return 0\n    product = 1\n    while n > 0:\n        product *= n % 10  # –£–º–Ω–æ–∂–∞–µ–º –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é —Ü–∏—Ñ—Ä—É\n        n //= 10  # –£–±–∏—Ä–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Ü–∏—Ñ—Ä—É\n    return product",
        test: "print(product_digits(12345))  # –î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ 120"
    },
    {
        name: "–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ç—É",
        description: "–ü—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —á–∏—Å–ª–æ –ø—Ä–æ—Å—Ç—ã–º. –§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç True, –µ—Å–ª–∏ —á–∏—Å–ª–æ –ø—Ä–æ—Å—Ç–æ–µ, –∏–Ω–∞—á–µ False.",
        code: "def is_prime(n):\n    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ç—É\n    if n < 2:\n        return False\n    if n == 2:\n        return True\n    if n % 2 == 0:\n        return False\n    for i in range(3, int(n**0.5) + 1, 2):\n        if n % i == 0:\n            return False\n    return True",
        test: "print(is_prime(17))  # –î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ True\nprint(is_prime(25))  # –î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ False"
    },
    {
        name: "–ß–∏—Å–ª–æ –§–∏–±–æ–Ω–∞—á—á–∏",
        description: "–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç n-–µ —á–∏—Å–ª–æ –§–∏–±–æ–Ω–∞—á—á–∏ (F(0)=0, F(1)=1).",
        code: "def fibonacci(n):\n    # n-–µ —á–∏—Å–ª–æ –§–∏–±–æ–Ω–∞—á—á–∏\n    if n <= 0:\n        return 0\n    elif n == 1:\n        return 1\n    else:\n        a, b = 0, 1\n        for i in range(2, n + 1):\n            a, b = b, a + b\n        return b",
        test: "print(fibonacci(10))  # –î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ 55"
    },
    {
        name: "–§–∞–∫—Ç–æ—Ä–∏–∞–ª",
        description: "–í—ã—á–∏—Å–ª—è–µ—Ç —Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª —á–∏—Å–ª–∞ n (n!).",
        code: "def factorial(n):\n    # –§–∞–∫—Ç–æ—Ä–∏–∞–ª —á–∏—Å–ª–∞\n    if n < 0:\n        return None  # –§–∞–∫—Ç–æ—Ä–∏–∞–ª –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –¥–ª—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö —á–∏—Å–µ–ª\n    result = 1\n    for i in range(2, n + 1):\n        result *= i\n    return result",
        test: "print(factorial(5))  # –î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ 120"
    },
    {
        name: "–†–∞–∑–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –º–Ω–æ–∂–∏—Ç–µ–ª–∏",
        description: "–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø—Ä–æ—Å—Ç—ã—Ö –º–Ω–æ–∂–∏—Ç–µ–ª–µ–π —á–∏—Å–ª–∞.",
        code: "def prime_factors(n):\n    # –†–∞–∑–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –ø—Ä–æ—Å—Ç—ã–µ –º–Ω–æ–∂–∏—Ç–µ–ª–∏\n    n = abs(n)\n    factors = []\n    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–µ–ª–∏–º–æ—Å—Ç—å –Ω–∞ 2\n    while n % 2 == 0:\n        factors.append(2)\n        n //= 2\n    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ—á–µ—Ç–Ω—ã–µ –¥–µ–ª–∏—Ç–µ–ª–∏\n    i = 3\n    while i * i <= n:\n        while n % i == 0:\n            factors.append(i)\n            n //= i\n        i += 2\n    if n > 1:\n        factors.append(n)\n    return factors",
        test: "print(prime_factors(84))  # –î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ [2, 2, 3, 7]"
    }
];

let currentProgrammerFunction = 0;

/* ================= –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ================= */
window.onload = function() {
    // –í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ/–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    //setTimeout(() => {
    //    document.getElementById("welcomeModal").style.display = "flex";
    //}, 500);
    
    // –ù–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã—Ö –∑–∞–¥–∞—á –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    updateTaskList();
    document.getElementById("taskInfoPanel").style.display = "none";
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è
    Split(['#codePanel', '#outputPanel'], {
        sizes: [50, 50],
        minSize: [200, 200],
        gutterSize: 6,
        cursor: 'col-resize',
        gutter: function(index, direction) {
            const gutter = document.createElement('div');
            gutter.className = 'gutter gutter-horizontal';
            return gutter;
        }
    });
    
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤–∫–ª—é—á–∞–µ–º —Å–∫—Ä–æ–ª–ª –¥–ª—è output
    document.getElementById('output').style.overflowY = 'auto';
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–µ–∂–∏–º —É—á–µ–Ω–∏–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    setMode('student');
};

/* ================= –†–ï–ñ–ò–ú–´ –£–ß–ò–¢–ï–õ–¨/–£–ß–ï–ù–ò–ö ================= */
function setMode(mode) {
    currentMode = mode;
    
    const studentBtn = document.getElementById('studentModeBtn');
    const teacherBtn = document.getElementById('teacherModeBtn');
    const teacherButtons = document.getElementById('teacherButtons');
    
    if (mode === 'student') {
        studentBtn.classList.add('student-active');
        teacherBtn.classList.remove('teacher-active');
        teacherButtons.style.display = 'none';
        
        // –û—Ç–∫–ª—é—á–∞–µ–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á
        document.getElementById('code').readOnly = true;
        document.getElementById('answerInput').readOnly = true;
        document.getElementById('videoUrl').readOnly = true;
        document.getElementById('solvedCheckbox').disabled = true;
    } else {
        studentBtn.classList.remove('student-active');
        teacherBtn.classList.add('teacher-active');
        teacherButtons.style.display = 'inline';
        
        // –í–∫–ª—é—á–∞–µ–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
        document.getElementById('code').readOnly = false;
        document.getElementById('answerInput').readOnly = false;
        document.getElementById('videoUrl').readOnly = false;
        document.getElementById('solvedCheckbox').disabled = false;
    }
}

/* ================= –ü–û–ö–ê–ó –ò–ù–°–¢–†–£–ö–¶–ò–ò ================= */
function showWelcomeModal() {
    document.getElementById("welcomeModal").style.display = "flex";
}

function closeWelcome() {
    document.getElementById("welcomeModal").style.display = "none";
}

/* ================= –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ü–û–ú–û–©–ò –ü–†–û–ì–†–ê–ú–ú–ï–†–ê ================= */
function showProgrammerModal() {
    document.getElementById("programmerModal").classList.add('show');
    updateProgrammerDisplay();
}

function closeProgrammerModal() {
    document.getElementById("programmerModal").classList.remove('show');
}

function selectProgrammerFunction(index) {
    currentProgrammerFunction = index;
    
    document.querySelectorAll('.function-btn').forEach((btn, i) => {
        if (i === index) {
            btn.classList.add('active');
        } else {
            btn.classList.remove('active');
        }
    });
    
    updateProgrammerDisplay();
}

function updateProgrammerDisplay() {
    const func = programmerFunctions[currentProgrammerFunction];
    document.getElementById('functionDescription').textContent = func.description;
    document.getElementById('functionCode').innerHTML = func.code.replace(/\n/g, '<br>').replace(/ /g, '&nbsp;');
}

function copyProgrammerCode() {
    const func = programmerFunctions[currentProgrammerFunction];
    navigator.clipboard.writeText(func.code + '\n\n' + func.test);
    alert('–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
}

function runProgrammerFunction() {
    const func = programmerFunctions[currentProgrammerFunction];
    const fullCode = func.code + '\n\n' + func.test;
    
    document.getElementById('code').value = fullCode;
    closeProgrammerModal();
    setTimeout(() => runPython(), 100);
}

function animateProgrammerFunction() {
    const func = programmerFunctions[currentProgrammerFunction];
    
    let animatedCode = '';
    
    if (currentProgrammerFunction === 0) {
        animatedCode = `def sum_digits(n):
    # –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å—É–º–º—ã —Ü–∏—Ñ—Ä —á–∏—Å–ª–∞
    # –ù–∞–ø—Ä–∏–º–µ—Ä: sum_digits(123) = 1+2+3 = 6
    
    total = 0
    # –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—É–º–º—ã
    
    n = abs(n)
    # –ë–µ—Ä–µ–º –∞–±—Å–æ–ª—é—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —á–∏—Å–ª–∞ (—Ä–∞–±–æ—Ç–∞–µ–º —Å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º–∏ —á–∏—Å–ª–∞–º–∏)
    
    while n > 0:
    # –ü–æ–∫–∞ –≤ —á–∏—Å–ª–µ –µ—Å—Ç—å —Ü–∏—Ñ—Ä—ã
        
        total += n % 10
        # –î–æ–±–∞–≤–ª—è–µ–º –∫ —Å—É–º–º–µ –ø–æ—Å–ª–µ–¥–Ω—é—é —Ü–∏—Ñ—Ä—É —á–∏—Å–ª–∞
        # –ù–∞–ø—Ä–∏–º–µ—Ä: 123 % 10 = 3
        
        n //= 10
        # –£–±–∏—Ä–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Ü–∏—Ñ—Ä—É —á–∏—Å–ª–∞
        # –ù–∞–ø—Ä–∏–º–µ—Ä: 123 // 10 = 12
    
    return total
    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–ª—É—á–µ–Ω–Ω—É—é —Å—É–º–º—É

# –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é
print(sum_digits(12345))  # –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: 15`;
    } else if (currentProgrammerFunction === 1) {
        animatedCode = `def product_digits(n):
    # –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —Ü–∏—Ñ—Ä —á–∏—Å–ª–∞
    # –ù–∞–ø—Ä–∏–º–µ—Ä: product_digits(123) = 1*2*3 = 6
    
    n = abs(n)
    # –ë–µ—Ä–µ–º –∞–±—Å–æ–ª—é—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —á–∏—Å–ª–∞
    
    if n == 0:
    # –û—Å–æ–±—ã–π —Å–ª—É—á–∞–π: —á–∏—Å–ª–æ —Ä–∞–≤–Ω–æ 0
        return 0
        # –ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ü–∏—Ñ—Ä —á–∏—Å–ª–∞ 0 —Ä–∞–≤–Ω–æ 0
    
    product = 1
    # –ù–∞—á–∏–Ω–∞–µ–º —Å 1, —Ç–∞–∫ –∫–∞–∫ —É–º–Ω–æ–∂–µ–Ω–∏–µ –Ω–∞ 1 –Ω–µ –º–µ–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    
    while n > 0:
    # –ü–æ–∫–∞ –≤ —á–∏—Å–ª–µ –µ—Å—Ç—å —Ü–∏—Ñ—Ä—ã
        
        product *= n % 10
        # –£–º–Ω–æ–∂–∞–µ–º –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é —Ü–∏—Ñ—Ä—É —á–∏—Å–ª–∞
        # –ù–∞–ø—Ä–∏–º–µ—Ä: 123 % 10 = 3
        
        n //= 10
        # –£–±–∏—Ä–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Ü–∏—Ñ—Ä—É —á–∏—Å–ª–∞
        # –ù–∞–ø—Ä–∏–º–µ—Ä: 123 // 10 = 12
    
    return product
    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–ª—É—á–µ–Ω–Ω–æ–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ

# –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é
print(product_digits(12345))  # –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: 120`;
    } else if (currentProgrammerFunction === 2) {
        animatedCode = `def is_prime(n):
    # –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —á–∏—Å–ª–∞ –Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ç—É
    # –ü—Ä–æ—Å—Ç–æ–µ —á–∏—Å–ª–æ –¥–µ–ª–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ 1 –∏ –Ω–∞ —Å–∞–º–æ —Å–µ–±—è
    
    if n < 2:
    # –ß–∏—Å–ª–∞ –º–µ–Ω—å—à–µ 2 –Ω–µ —è–≤–ª—è—é—Ç—Å—è –ø—Ä–æ—Å—Ç—ã–º–∏
        return False
    
    if n == 2:
    # 2 - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ —á–µ—Ç–Ω–æ–µ –ø—Ä–æ—Å—Ç–æ–µ —á–∏—Å–ª–æ
        return True
    
    if n % 2 == 0:
    # –ß–µ—Ç–Ω—ã–µ —á–∏—Å–ª–∞ –±–æ–ª—å—à–µ 2 –Ω–µ —è–≤–ª—è—é—Ç—Å—è –ø—Ä–æ—Å—Ç—ã–º–∏
        return False
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ—á–µ—Ç–Ω—ã–µ –¥–µ–ª–∏—Ç–µ–ª–∏ –¥–æ –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–≥–æ –∫–æ—Ä–Ω—è –∏–∑ n
    for i in range(3, int(n**0.5) + 1, 2):
    # range(3, sqrt(n)+1, 2) –¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–µ—á–µ—Ç–Ω—ã–µ —á–∏—Å–ª–∞
        
        if n % i == 0:
        # –ï—Å–ª–∏ –Ω–∞—à–µ–ª—Å—è –¥–µ–ª–∏—Ç–µ–ª—å
            return False
            # –ß–∏—Å–ª–æ —Å–æ—Å—Ç–∞–≤–Ω–æ–µ
    
    return True
    # –ï—Å–ª–∏ –¥–µ–ª–∏—Ç–µ–ª–µ–π –Ω–µ –Ω–∞—à–ª–æ—Å—å - —á–∏—Å–ª–æ –ø—Ä–æ—Å—Ç–æ–µ

# –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é
print(is_prime(17))  # –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: True
print(is_prime(25))  # –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: False`;
    } else if (currentProgrammerFunction === 3) {
        animatedCode = `def fibonacci(n):
    # –§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç n-–µ —á–∏—Å–ª–æ –§–∏–±–æ–Ω–∞—á—á–∏
    # –†—è–¥ –§–∏–±–æ–Ω–∞—á—á–∏: 0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55...
    
    if n <= 0:
    # –ë–∞–∑–æ–≤—ã–π —Å–ª—É—á–∞–π: F(0) = 0
        return 0
    
    elif n == 1:
    # –ë–∞–∑–æ–≤—ã–π —Å–ª—É—á–∞–π: F(1) = 1
        return 1
    
    else:
    # –†–µ–∫—É—Ä—Ä–µ–Ω—Ç–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞: F(n) = F(n-1) + F(n-2)
        a, b = 0, 1
        # a = F(0), b = F(1)
        
        for i in range(2, n + 1):
        # –í—ã—á–∏—Å–ª—è–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –æ—Ç F(2) –¥–æ F(n)
            a, b = b, a + b
            # a = –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —á–∏—Å–ª–æ, b = —Ç–µ–∫—É—â–µ–µ
            # –ù–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ —Å–¥–≤–∏–≥–∞–µ–º—Å—è –≤–ø–µ—Ä–µ–¥
        
        return b
        # –í–æ–∑–≤—Ä–∞—â–∞–µ–º n-–µ —á–∏—Å–ª–æ

# –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é
print(fibonacci(10))  # –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: 55`;
    } else if (currentProgrammerFunction === 4) {
        animatedCode = `def factorial(n):
    # –§—É–Ω–∫—Ü–∏—è –≤—ã—á–∏—Å–ª—è–µ—Ç —Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª —á–∏—Å–ª–∞ n
    # –§–∞–∫—Ç–æ—Ä–∏–∞–ª: n! = 1 * 2 * 3 * ... * n
    # –ù–∞–ø—Ä–∏–º–µ—Ä: 5! = 1*2*3*4*5 = 120
    
    if n < 0:
    # –§–∞–∫—Ç–æ—Ä–∏–∞–ª –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –¥–ª—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö —á–∏—Å–µ–ª
        return None
    
    result = 1
    # –ù–∞—á–∏–Ω–∞–µ–º —Å 1
    
    for i in range(2, n + 1):
    # –£–º–Ω–æ–∂–∞–µ–º –Ω–∞ –≤—Å–µ —á–∏—Å–ª–∞ –æ—Ç 2 –¥–æ n
        result *= i
        # result = result * i
    
    return result
    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç

# –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é
print(factorial(5))  # –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: 120`;
    } else if (currentProgrammerFunction === 5) {
        animatedCode = `def prime_factors(n):
    # –§—É–Ω–∫—Ü–∏—è —Ä–∞–∑–ª–∞–≥–∞–µ—Ç —á–∏—Å–ª–æ –Ω–∞ –ø—Ä–æ—Å—Ç—ã–µ –º–Ω–æ–∂–∏—Ç–µ–ª–∏
    # –ù–∞–ø—Ä–∏–º–µ—Ä: 84 = 2 * 2 * 3 * 7
    
    n = abs(n)
    # –ë–µ—Ä–µ–º –∞–±—Å–æ–ª—é—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
    
    factors = []
    # –°–ø–∏—Å–æ–∫ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–Ω–æ–∂–∏—Ç–µ–ª–µ–π
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–µ–ª–∏–º–æ—Å—Ç—å –Ω–∞ 2
    while n % 2 == 0:
    # –ü–æ–∫–∞ —á–∏—Å–ª–æ –¥–µ–ª–∏—Ç—Å—è –Ω–∞ 2
        factors.append(2)
        # –î–æ–±–∞–≤–ª—è–µ–º 2 –≤ —Å–ø–∏—Å–æ–∫ –º–Ω–æ–∂–∏—Ç–µ–ª–µ–π
        n //= 2
        # –î–µ–ª–∏–º —á–∏—Å–ª–æ –Ω–∞ 2
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ—á–µ—Ç–Ω—ã–µ –¥–µ–ª–∏—Ç–µ–ª–∏
    i = 3
    # –ù–∞—á–∏–Ω–∞–µ–º —Å 3
    
    while i * i <= n:
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–≥–æ –∫–æ—Ä–Ω—è –∏–∑ n
        while n % i == 0:
        # –ü–æ–∫–∞ —á–∏—Å–ª–æ –¥–µ–ª–∏—Ç—Å—è –Ω–∞ i
            factors.append(i)
            # –î–æ–±–∞–≤–ª—è–µ–º i –≤ —Å–ø–∏—Å–æ–∫ –º–Ω–æ–∂–∏—Ç–µ–ª–µ–π
            n //= i
            # –î–µ–ª–∏–º —á–∏—Å–ª–æ –Ω–∞ i
        i += 2
        # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –Ω–µ—á–µ—Ç–Ω–æ–º—É —á–∏—Å–ª—É
    
    if n > 1:
    # –ï—Å–ª–∏ –æ—Å—Ç–∞—Ç–æ–∫ –±–æ–ª—å—à–µ 1, —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ–π –º–Ω–æ–∂–∏—Ç–µ–ª—å
        factors.append(n)
    
    return factors
    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–∏—Å–æ–∫ –º–Ω–æ–∂–∏—Ç–µ–ª–µ–π

# –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é
print(prime_factors(84))  # –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: [2, 2, 3, 7]`;
    }
    
    document.getElementById('code').value = animatedCode;
    closeProgrammerModal();
    setTimeout(() => startCodeAnimation(), 100);
}

/* ================= –†–ï–ñ–ò–ú–´ –ö–û–î–ê ================= */
function setCodeMode(mode) {
    codeMode = mode;
    
    document.getElementById('codeModeNoComments').classList.toggle('active', mode === 'noComments');
    document.getElementById('codeModeWithComments').classList.toggle('active', mode === 'withComments');
    
    if (current !== -1 && tasks[current]) {
        const task = tasks[current];
        if (mode === 'withComments' && task.codeWithComments) {
            document.getElementById('code').value = task.codeWithComments;
        } else if (mode === 'noComments' && task.codeNoComments) {
            document.getElementById('code').value = task.codeNoComments;
        } else {
            document.getElementById('code').value = task.codeWithComments || task.codeNoComments || task.code || '';
        }
    }
}

/* ================= –†–ò–°–û–í–ê–ù–ò–ï ================= */
const canvas = document.getElementById('drawCanvas');
const ctx = canvas.getContext("2d");
let drawEnabled = false, drawing = false, history = [];
let color = "#ffff00";

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

function setColor(newColor) {
    color = newColor;
    document.querySelectorAll('.color-btn').forEach(btn => {
        btn.classList.remove('active', 'drawing');
    });
    event.target.classList.add('active', 'drawing');
    
    if (!drawEnabled) {
        drawEnabled = true;
        canvas.style.pointerEvents = "auto";
    }
}

function setPenSize(size) {
    penSize = size;
    document.querySelectorAll('.pen-size-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    if (!drawEnabled) {
        drawEnabled = true;
        canvas.style.pointerEvents = "auto";
    }
}

canvas.addEventListener("pointerdown", e => {
    if (!drawEnabled) return;
    drawing = true;
    history.push(ctx.getImageData(0, 0, canvas.width, canvas.height));
    ctx.strokeStyle = color;
    ctx.lineWidth = penSize;
    ctx.lineCap = "round";
    ctx.lineJoin = "round";
    ctx.beginPath();
    ctx.moveTo(e.clientX, e.clientY);
});

canvas.addEventListener("pointermove", e => {
    if (!drawing) return;
    ctx.lineTo(e.clientX, e.clientY);
    ctx.stroke();
});

canvas.addEventListener("pointerup", () => drawing = false);
canvas.addEventListener("pointerleave", () => drawing = false);

function undo() {
    if (history.length) ctx.putImageData(history.pop(), 0, 0);
}
function clearCanvas() {
    history.push(ctx.getImageData(0, 0, canvas.width, canvas.height));
    ctx.clearRect(0, 0, canvas.width, canvas.height);
}

/* ================= –ü–ï–ß–ê–¢–¨ ================= */
function showPrintDialog() {
    if (tasks.length === 0) {
        alert("–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –∑–∞–¥–∞—á–∏!");
        return;
    }
    
    const dialog = document.getElementById("printDialog");
    const checkboxes = document.getElementById("printCheckboxes");
    
    checkboxes.innerHTML = "";
    printCheckboxes = {};
    
    tasks.forEach((task, i) => {
        const div = document.createElement("div");
        div.className = "print-task-item";
        div.innerHTML = `
            <input type="checkbox" id="print_${i}" value="${i}">
            <label for="print_${i}">${i + 1}. ${task.name}</label>
        `;
        checkboxes.appendChild(div);
        
        printCheckboxes[i] = div.querySelector(`#print_${i}`);
        div.onclick = (e) => {
            if (e.target.tagName !== 'INPUT') {
                printCheckboxes[i].checked = !printCheckboxes[i].checked;
            }
        };
    });
    
    dialog.style.display = "flex";
}

function closePrintDialog() {
    document.getElementById("printDialog").style.display = "none";
}

function selectAllForPrint() {
    Object.values(printCheckboxes).forEach(cb => cb.checked = true);
}

function deselectAllForPrint() {
    Object.values(printCheckboxes).forEach(cb => cb.checked = false);
}

function printSelectedTasks() {
    const selected = Object.keys(printCheckboxes).filter(i => printCheckboxes[i].checked);
    if (!selected.length) return alert("–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞—á–∏!");
    
    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
        <!DOCTYPE html>
        <html><head><title>–ó–∞–¥–∞—á–∏</title>
        <style>
            body { margin: 20px; font-family: Arial; font-size: 16px; line-height: 1.6; color: #333; }
            .task { page-break-inside: avoid; margin-bottom: 40px; }
            h3 { color: #1e293b; margin: 0 0 20px 0; font-size: 18px; }
            .condition { background: #f8fafc; padding: 25px; border-radius: 8px; 
                        border-left: 5px solid #3b82f6; margin: 15px 0; white-space: pre-wrap; }
            .answer { background: #ecfdf5; padding: 20px; border-radius: 8px; 
                     border-left: 5px solid #10b981; margin-top: 15px; }
            .video-link { background: #e0f2fe; padding: 12px 20px; border-radius: 8px; 
                         border-left: 5px solid #0284c7; margin: 15px 0; }
            hr { margin: 30px 0; border: none; border-top: 2px solid #e2e8f0; }
            a { color: #1e293b; }
            @media print { body { margin: 15px; } }
        </style></head><body>
    `);
    
    selected.forEach(i => {
        const task = tasks[i];
        printWindow.document.write(`
            <div class="task">
                <h3>${i + 1}. ${task.name}</h3>
                ${task.text ? `<div class="condition">${task.text.replace(/\n/g, '<br>')}</div>` : ''}
                ${task.answer ? `<div class="answer"><strong>‚úÖ –û—Ç–≤–µ—Ç:</strong> ${task.answer}</div>` : ''}
                ${task.video ? `<div class="video-link"><strong>üìπ –í–∏–¥–µ–æ:</strong> <a href="${task.video}" target="_blank">${task.video}</a></div>` : ''}
                ${task.fileUrl ? `<div class="video-link"><strong>üìÅ –§–∞–π–ª:</strong> <a href="${task.fileUrl}" target="_blank">${task.fileUrl}</a></div>` : ''}
                <hr>
            </div>
        `);
    });
    
    printWindow.document.write('</body></html>');
    printWindow.document.close();
    closePrintDialog();
}

/* ================= –í–ò–î–ï–û ================= */
function updateVideo() {
    const url = document.getElementById("videoUrl").value.trim();
    const embedUrl = getVideoEmbedUrl(url);
    
    if (url && embedUrl) {
        document.getElementById("videoPlayBtn").style.display = 'block';
        document.getElementById("videoPlayBtn").dataset.embed = embedUrl;
    } else {
        document.getElementById("videoPlayBtn").style.display = 'none';
    }
    updateTaskInfoPanel();
}

function getVideoEmbedUrl(url) {
    url = url.trim();
    
    if (url.includes('rutube.ru/video/')) {
        const videoId = url.match(/rutube\.ru\/video\/([a-f0-9]{32})/i)?.[1];
        if (videoId) return `https://rutube.ru/embed/${videoId}`;
    }
    
    let match = url.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\\s]{11})/i);
    if (match) return `https://www.youtube.com/embed/${match[1]}?autoplay=1&rel=0`;
    
    match = url.match(/vimeo\.com\/(\d+)/i);
    if (match) return `https://player.vimeo.com/video/${match[1]}?autoplay=1`;
    
    if (url.match(/\.(mp4|webm|ogg|mkv)$/i)) return url;
    
    return '';
}

function playVideo() {
    const embedUrl = document.getElementById("videoPlayBtn").dataset.embed;
    if (embedUrl) {
        document.getElementById("modalVideo").src = embedUrl;
        document.getElementById("videoModal").classList.add('show');
        document.body.style.overflow = 'hidden';
    }
}

function closeVideoModal(event) {
    if (event && event.target === event.currentTarget) {
        document.getElementById("videoModal").classList.remove('show');
        document.getElementById("modalVideo").src = '';
        document.body.style.overflow = '';
    }
}

function toggleFullscreen(event) {
    event.stopPropagation();
    const modal = document.getElementById("videoModal");
    if (modal.requestFullscreen) {
        modal.requestFullscreen();
    } else if (modal.webkitRequestFullscreen) {
        modal.webkitRequestFullscreen();
    }
}

/* ================= PYTHON ================= */
async function initPy() {
    pyodide = await loadPyodide({
        indexURL: "https://cdn.jsdelivr.net/pyodide/v0.24.1/full/"
    });
    ready = true;
    const output = document.getElementById("output");
    output.textContent = "Python –≥–æ—Ç–æ–≤.";
    output.style.overflowY = "auto";
}
initPy();

async function runPython() {
    if (!ready) return;
    
    const output = document.getElementById("output");
    output.style.overflowY = "auto";
    
    try {
        output.textContent = "";
        
        pyodide.runPython(`
import sys
from io import StringIO
sys.stdout = StringIO()
        `);
        
        pyodide.runPython(document.getElementById("code").value);
        
        const result = pyodide.runPython("sys.stdout.getvalue()");
        output.textContent = result || "–ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ (–Ω–µ—Ç –≤—ã–≤–æ–¥–∞)";
        output.className = "";
    } catch (e) {
        output.textContent = "–û—à–∏–±–∫–∞: " + e.toString();
        output.className = "error";
    }
}

/* ================= –†–ê–ë–û–¢–ê –° –§–ê–ô–õ–ê–ú–ò ================= */
function setExampleUrl() {
    document.getElementById('fileUrlInput').value = 'https://raw.githubusercontent.com/username/repo/main/24_1111.txt';
}

function showFileLoadModal() {
    document.getElementById('fileLoadModal').classList.add('show');
    
    if (current !== -1 && tasks[current] && tasks[current].fileUrl) {
        document.getElementById('fileUrlInput').value = tasks[current].fileUrl;
    } else {
        document.getElementById('fileUrlInput').value = '';
    }
    document.getElementById('fileContentInput').value = '';
}

function closeFileLoadModal() {
    document.getElementById('fileLoadModal').classList.remove('show');
}

async function loadFileFromUrl() {
    const url = document.getElementById('fileUrlInput').value.trim();
    if (!url) {
        alert("–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Ñ–∞–π–ª!");
        return;
    }
    
    const output = document.getElementById('output');
    output.innerHTML = `‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ —Å ${url}...`;
    
    try {
        const response = await fetch(url);
        
        if (!response.ok) {
            throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${response.status} ${response.statusText}`);
        }
        
        const text = await response.text();
        
        loadedFileContent = text;
        loadedFileName = url.split('/').pop() || 'file.txt';
        
        output.innerHTML = `‚úÖ –§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω!\n`;
        output.innerHTML += `–ò–º—è: ${loadedFileName}\n`;
        output.innerHTML += `–†–∞–∑–º–µ—Ä: ${text.length} —Å–∏–º–≤–æ–ª–æ–≤\n`;
        output.innerHTML += `–°—Ç—Ä–æ–∫: ${text.split('\n').length}\n`;
        output.innerHTML += `–ü–µ—Ä–≤—ã–µ 200 —Å–∏–º–≤–æ–ª–æ–≤:\n${"-".repeat(50)}\n`;
        output.innerHTML += text.substring(0, 200) + "...";
        
        output.innerHTML += `\n\n${"=".repeat(60)}`;
        output.innerHTML += `\n‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è file_content –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ Python!\n`;
        output.innerHTML += `${"=".repeat(60)}\n`;
        output.innerHTML += `# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:\n`;
        output.innerHTML += `lines = file_content.split('\\n')\n`;
        output.innerHTML += `first_line = lines[0] if lines else ""\n`;
        output.innerHTML += `for k in range(1, 100):\n`;
        output.innerHTML += `    if 'C'*k in first_line:\n`;
        output.innerHTML += `        print(f"–ù–∞–π–¥–µ–Ω–æ {k} –±—É–∫–≤ C")\n`;
        
        if (current !== -1 && tasks[current]) {
            tasks[current].fileUrl = url;
            updateTaskInfoPanel();
        }
        
        closeFileLoadModal();
        
    } catch (e) {
        output.innerHTML = `‚ùå –û—à–∏–±–∫–∞: ${e.message}\n\n`;
        output.innerHTML += "–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:\n";
        output.innerHTML += "1. –°—Å—ã–ª–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ (–ø—É–±–ª–∏—á–Ω—ã–π —Ñ–∞–π–ª)\n";
        output.innerHTML += "2. –î–ª—è GitHub –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ raw-—Å—Å—ã–ª–∫—É\n";
        output.innerHTML += "3. –°–µ—Ä–≤–µ—Ä —Ä–∞–∑—Ä–µ—à–∞–µ—Ç CORS –∑–∞–ø—Ä–æ—Å—ã";
        output.className = "error";
    }
}

function usePastedFileContent() {
    const content = document.getElementById('fileContentInput').value;
    if (!content.trim()) {
        alert("–í—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞!");
        return;
    }
    
    loadedFileContent = content;
    loadedFileName = "pasted_text.txt";
    
    const output = document.getElementById('output');
    output.innerHTML = `‚úÖ –¢–µ–∫—Å—Ç –∑–∞–≥—Ä—É–∂–µ–Ω!\n`;
    output.innerHTML += `–†–∞–∑–º–µ—Ä: ${content.length} —Å–∏–º–≤–æ–ª–æ–≤\n`;
    output.innerHTML += `–°—Ç—Ä–æ–∫: ${content.split('\n').length}\n`;
    output.innerHTML += `–ü–µ—Ä–≤—ã–µ 200 —Å–∏–º–≤–æ–ª–æ–≤:\n${"-".repeat(50)}\n`;
    output.innerHTML += content.substring(0, 200) + "...";
    
    output.innerHTML += `\n\n${"=".repeat(60)}`;
    output.innerHTML += `\n‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è file_content –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ Python!\n`;
    output.innerHTML += `${"=".repeat(60)}\n`;
    
    closeFileLoadModal();
}

async function runWithFile() {
    if (!ready) {
        alert("Pyodide –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω!");
        return;
    }
    
    if (!loadedFileContent) {
        alert("–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª! –ù–∞–∂–º–∏—Ç–µ 'üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª'");
        showFileLoadModal();
        return;
    }
    
    const output = document.getElementById('output');
    
    try {
        const escapedContent = loadedFileContent
            .replace(/\\/g, '\\\\')
            .replace(/`/g, '\\`')
            .replace(/\${/g, '\\${');
        
        // –°–û–ó–î–ê–ï–ú –ü–ï–†–ï–ú–ï–ù–ù–£–Æ file_content –í PYTHON
        const pythonPreamble = `
# –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π file_content
file_content = """${escapedContent}"""
`;
        
        // –ü–æ–ª—É—á–∞–µ–º –∫–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const userCode = document.getElementById('code').value;
        
        // –û–±—ä–µ–¥–∏–Ω—è–µ–º
        const fullCode = pythonPreamble + "\n" + userCode;
        
        pyodide.runPython(`
import sys
from io import StringIO
sys.stdout = StringIO()
        `);
        
        pyodide.runPython(fullCode);
        
        const result = pyodide.runPython("sys.stdout.getvalue()");
        output.innerHTML = result || "–ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ (–Ω–µ—Ç –≤—ã–≤–æ–¥–∞)";
        output.className = "";
        
    } catch (e) {
        output.innerHTML = "–û—à–∏–±–∫–∞: " + e.toString();
        output.className = "error";
    }
}

/* ================= –ê–ù–ò–ú–ê–¶–ò–Ø –ö–û–î–ê ================= */
function startCodeAnimation() {
    const output = document.getElementById('output');
    output.style.overflowY = 'auto';
    
    document.getElementById('animationIndicator').style.display = 'inline-flex';
    
    let codeToAnimate = '';
    
    if (current !== -1 && tasks[current] && tasks[current].codeWithComments) {
        codeToAnimate = tasks[current].codeWithComments;
    } else {
        codeToAnimate = document.getElementById('code').value;
    }
    
    if (!codeToAnimate.trim()) {
        alert('–°–Ω–∞—á–∞–ª–∞ –Ω–∞–ø–∏—à–∏—Ç–µ –∫–æ–¥!');
        return;
    }
    
    animationFullCode = codeToAnimate;
    stopAnimation();
    
    const allLines = codeToAnimate.split('\n');
    
    animationLines = [];
    let i = 0;
    
    while (i < allLines.length) {
        const currentLine = allLines[i];
        
        if (currentLine.trim().startsWith('#') && i > 0 && !allLines[i - 1].trim().startsWith('#')) {
            i++;
            continue;
        }
        
        const group = [];
        group.push(currentLine);
        i++;
        
        while (i < allLines.length && allLines[i].trim().startsWith('#')) {
            group.push(allLines[i]);
            i++;
        }
        
        animationLines.push(group);
    }
    
    currentAnimLine = 0;
    animationActive = true;
    
    output.innerHTML = '';
    output.style.whiteSpace = 'pre';
    output.style.fontFamily = 'Consolas, monospace';
    output.style.fontSize = '18px';
    output.style.lineHeight = '1.6';
    output.style.color = '#e5e7eb';
    
    document.addEventListener('keydown', handleAnimationKey);
    
    processNextGroup();
}

function stopAnimation() {
    animationActive = false;
    if (animationInterval) {
        clearInterval(animationInterval);
        animationInterval = null;
    }
    document.removeEventListener('keydown', handleAnimationKey);
    document.getElementById('animationIndicator').style.display = 'none';
}





function handleAnimationKey(e) {
    if (!animationActive) return;
    
    if (e.key === "Escape") {
        stopAnimation();
        document.getElementById('output').innerHTML += '\n\n‚è∏Ô∏è –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ';
        return;
    }
    
    // –ï—Å–ª–∏ –Ω–∞–∂–∞—Ç –ù–ï –ø—Ä–æ–±–µ–ª - –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º
    if (e.key !== " ") {
        e.preventDefault();
        return; // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–ª–∞–≤–∏—à–∏
    }
    
    e.preventDefault();
    currentAnimLine++;
    processNextGroup();
}

function processNextGroup() {
    if (!animationActive) return;
    
    if (currentAnimLine >= animationLines.length) {
        const output = document.getElementById('output');
        output.innerHTML += '\n\n‚úÖ –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!';
        output.style.color = '#22c55e';
        stopAnimation();
        return;
    }
    
    const group = animationLines[currentAnimLine];
    const output = document.getElementById('output');
    
    const groupElement = document.createElement('div');
    groupElement.style.margin = '0 0 0 0';
    groupElement.style.padding = '0';
    groupElement.style.fontFamily = 'Consolas, monospace';
    groupElement.style.whiteSpace = 'pre';
    
    output.appendChild(groupElement);
    
    if (group.length === 1) {
        const line = group[0];
        lineElement = document.createElement('div');
        lineElement.style.margin = '0';
        lineElement.style.padding = '0';
        groupElement.appendChild(lineElement);
        
        const isCommentLine = line.trim().startsWith('#');
        
        if (isCommentLine) {
            lineElement.innerHTML = `<span class="animation-comment">${line}</span>`;
            lineElement.classList.add('typed');
            
            setTimeout(() => {
                if (animationActive) {
                    currentAnimLine++;
                    processNextGroup();
                }
            }, 50);
        } else {
            animateLine(lineElement, line);
        }
    } else {
        animateGroup(groupElement, group);
    }
}

function animateGroup(container, lines) {
    const lineElements = [];
    
    lines.forEach((line, idx) => {
        const lineDiv = document.createElement('div');
        lineDiv.style.margin = '0';
        lineDiv.style.padding = '0';
        lineDiv.style.fontFamily = 'Consolas, monospace';
        lineDiv.style.whiteSpace = 'pre';
        container.appendChild(lineDiv);
        lineElements.push(lineDiv);
    });
    
    const currentIndices = new Array(lines.length).fill(0);
    
    function typeNextChar() {
        if (!animationActive) return;
        
        let allCompleted = true;
        
        for (let i = 0; i < lines.length; i++) {
            if (currentIndices[i] < lines[i].length) {
                allCompleted = false;
                
                const currentText = lines[i].substring(0, currentIndices[i] + 1);
                
                if (i === 0) {
                    lineElements[i].innerHTML = currentText;
                } else {
                    lineElements[i].innerHTML = `<span class="animation-comment">${currentText}</span>`;
                }
                
                currentIndices[i]++;
            } else {
                if (i === 0) {
                    lineElements[i].innerHTML = lines[i];
                } else {
                    lineElements[i].innerHTML = `<span class="animation-comment">${lines[i]}</span>`;
                }
            }
        }
        
        const output = document.getElementById('output');
        output.scrollTop = output.scrollHeight;
        
        if (!allCompleted) {
            animationInterval = setTimeout(typeNextChar, animationSpeed);
        } else {
            animationInterval = null;
        }
    }
    
    typeNextChar();
}

function animateLine(element, fullLine) {
    let index = 0;
    element.innerHTML = '';
    
    function typeNextChar() {
        if (!animationActive) return;
        
        if (index < fullLine.length) {
            const currentText = fullLine.substring(0, index + 1);
            
            const commentIndex = currentText.indexOf('#');
            if (commentIndex !== -1) {
                const beforeComment = currentText.substring(0, commentIndex);
                const comment = currentText.substring(commentIndex);
                element.innerHTML = `${beforeComment}<span class="animation-comment">${comment}</span>`;
            } else {
                element.innerHTML = currentText;
            }
            
            index++;
            
            const output = document.getElementById('output');
            output.scrollTop = output.scrollHeight;
            
            animationInterval = setTimeout(typeNextChar, animationSpeed);
        } else {
            element.classList.add('typed');
            animationInterval = null;
        }
    }
    
    typeNextChar();
}

/* ================= –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò ================= */
function toggleAnswer() {
    const answerInput = document.getElementById("answerInput");
    answerInput.style.display = answerInput.style.display === "none" ? "block" : "none";
}

function copyCode() {
    navigator.clipboard.writeText(document.getElementById("code").value);
    alert("–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!");
}

async function pasteText() {
    try {
        const text = await navigator.clipboard.readText();
        taskTextGlobal = text;
        const taskTextDiv = document.getElementById("taskText");
        taskTextDiv.innerHTML = highlightNumbers(text);
        taskTextDiv.style.display = "block";
        document.getElementById("taskImage").style.display = "none";
        document.getElementById("videoPlayBtn").style.display = "none";

        updateVideo();
    } catch (e) {
        alert("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –±—É—Ñ–µ—Ä–∞: " + e.message);
    }
}

async function pasteImage() {
    const items = await navigator.clipboard.read();
    for (const item of items)
        for (const type of item.types)
            if (type.startsWith("image/")) {
                const blob = await item.getType(type);
                const reader = new FileReader();
                reader.onload = () => {
                    document.getElementById("taskImage").src = reader.result;
                    document.getElementById("taskImage").style.display = "block";
                    document.getElementById("taskText").style.display = "none";
                    document.getElementById("videoPlayBtn").style.display = "none";
                    taskTextGlobal = "";
                    
                    updateVideo();
                };
                reader.readAsDataURL(blob);
                return;
            }
    alert("–í –±—É—Ñ–µ—Ä–µ –Ω–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π!");
}

function highlightNumbers(text) {
    const numberRegex = /\b\d+(?:\.?\d+)?(?:[+%√ó√∑=‚â§‚â•<>¬∞¬≤¬≥]|—Ä—É–±|USD|[a-zA-Z–∞-—è–ê-–Ø]{0,3})?\b/gi;
    return text.replace(numberRegex, '<span class="number">$&</span>');
}

/* ================= –ó–ê–î–ê–ß–ò ================= */
function updateTaskInfoPanel() {
    const panel = document.getElementById("taskInfoPanel");
    const titleEl = document.getElementById("taskInfoTitle");
    const analogEl = document.getElementById("taskInfoAnalog");
    const videoEl = document.getElementById("taskInfoVideo");
    const fileEl = document.getElementById("taskInfoFile");
    const fileLink = document.getElementById("fileLink");
    
    if (current === -1 || !tasks[current]) {
        panel.style.display = "none";
        return;
    }
    
    const task = tasks[current];
    panel.style.display = "flex";
    titleEl.textContent = `${current + 1}. ${task.name}`;
    
    const analogIndex = tasks.findIndex((t, i) =>
        i !== current &&
        t.name.includes(task.name.replace('-–∞–Ω–∞–ª–æ–≥', '')) &&
        t.name.includes('–∞–Ω–∞–ª–æ–≥')
    );
    
    if (analogIndex !== -1) {
        analogEl.style.display = "flex";
        analogEl.innerHTML = `üîÑ –ê–Ω–∞–ª–æ–≥: <a href="#" onclick="showTask(${analogIndex}); return false;">${analogIndex + 1}. ${tasks[analogIndex].name}</a>`;
    } else {
        analogEl.style.display = "none";
    }
    
    if (task.video) {
        videoEl.style.display = "flex";
        videoEl.innerHTML = `üìπ –í–∏–¥–µ–æ: <a href="${task.video}" target="_blank">—Å—Å—ã–ª–∫–∞</a>`;
    } else {
        videoEl.style.display = "none";
    }
    
    if (task.fileUrl) {
        fileEl.style.display = "flex";
        fileLink.href = task.fileUrl;
        fileLink.textContent = task.fileUrl.length > 40 ? task.fileUrl.substring(0, 40) + "..." : task.fileUrl;
    } else {
        fileEl.style.display = "none";
    }
}

function reorganizeTasksAfterImport() {
    const originalTasks = [...tasks];
    tasks = [];
    
    const nonAnalogTasks = originalTasks.filter(t => !t.name.includes('-–∞–Ω–∞–ª–æ–≥') && !t.name.includes('–∞–Ω–∞–ª–æ–≥'));
    nonAnalogTasks.forEach(task => {
        tasks.push(task);
        const analog = originalTasks.find(t =>
            t.name.includes(task.name) &&
            (t.name.includes('-–∞–Ω–∞–ª–æ–≥') || t.name.includes('–∞–Ω–∞–ª–æ–≥'))
        );
        if (analog) {
            tasks.push(analog);
        }
    });
    
    const remainingAnalogs = originalTasks.filter(t =>
        (t.name.includes('-–∞–Ω–∞–ª–æ–≥') || t.name.includes('–∞–Ω–∞–ª–æ–≥')) &&
        !tasks.includes(t)
    );
    tasks.push(...remainingAnalogs);
}

function showTask(i) {
    const t = tasks[i];
    current = i;
    currentTaskData = t;
    
    if (codeMode === 'withComments' && t.codeWithComments) {
        document.getElementById("code").value = t.codeWithComments;
    } else if (codeMode === 'noComments' && t.codeNoComments) {
        document.getElementById("code").value = t.codeNoComments;
    } else {
        document.getElementById("code").value = t.codeWithComments || t.codeNoComments || t.code || "";
    }
    
    document.getElementById("answerInput").value = t.answer || "";
    document.getElementById("videoUrl").value = t.video || "";
    document.getElementById("solvedCheckbox").checked = t.solved || false;
    taskTextGlobal = t.text || "";
    
    updateVideo();
    updateSolvedCheckbox();
    updateTaskInfoPanel();
    
    if (t.image) {
        document.getElementById("taskImage").src = t.image;
        document.getElementById("taskImage").style.display = "block";
        document.getElementById("taskText").style.display = "none";
    } else if (t.text) {
        document.getElementById("taskText").innerHTML = highlightNumbers(t.text);
        document.getElementById("taskText").style.display = "block";
        document.getElementById("taskImage").style.display = "none";
    } else {
        document.getElementById("taskImage").style.display = "none";
        document.getElementById("taskText").style.display = "none";
    }
    
    updateTaskList();
}

function updateSolvedCheckbox() {
    document.getElementById("solvedContainer").classList.toggle('solved', document.getElementById("solvedCheckbox").checked);
}

document.getElementById("solvedCheckbox").onchange = function() {
    updateSolvedCheckbox();
    if (current !== -1 && tasks[current]) {
        tasks[current].solved = this.checked;
        updateTaskList();
        updateTaskInfoPanel();
    }
};

/* ================= –î–ò–ê–õ–û–ì –°–û–•–†–ê–ù–ï–ù–ò–Ø ================= */
function showSaveDialog() {
    document.getElementById("saveTaskName").value = currentTaskData ? currentTaskData.name : "–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞";
    document.getElementById("saveFileUrl").value = currentTaskData && currentTaskData.fileUrl ? currentTaskData.fileUrl : "";
    document.getElementById("saveDialog").classList.add('show');
}

function closeSaveDialog() {
    document.getElementById("saveDialog").classList.remove('show');
}

function saveTaskWithName() {
    const newName = document.getElementById("saveTaskName").value.trim();
    if (!newName) {
        alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏!");
        return;
    }
    
    const fileUrl = document.getElementById("saveFileUrl").value.trim();
    const currentCode = document.getElementById("code").value;
    
    const taskData = {
        name: newName,
        codeWithComments: codeMode === 'withComments' ? currentCode : (currentTaskData?.codeWithComments || ""),
        codeNoComments: codeMode === 'noComments' ? currentCode : (currentTaskData?.codeNoComments || ""),
        answer: document.getElementById("answerInput").value,
        image: document.getElementById("taskImage").src || "",
        text: taskTextGlobal,
        video: document.getElementById("videoUrl").value,
        fileUrl: fileUrl || "",
        solved: document.getElementById("solvedCheckbox").checked,
        favorite: currentTaskData?.favorite || false
    };

    if (current === -1) {
        tasks.push(taskData);
        current = tasks.length - 1;
    } else {
        tasks[current] = taskData;
    }
    
    currentTaskData = taskData;
    updateTaskList();
    updateTaskInfoPanel();
    closeSaveDialog();
}

function saveAsNewTask() {
    const newName = document.getElementById("saveTaskName").value.trim();
    if (!newName) {
        alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏!");
        return;
    }
    
    const fileUrl = document.getElementById("saveFileUrl").value.trim();
    const currentCode = document.getElementById("code").value;
    
    const taskData = {
        name: newName,
        codeWithComments: codeMode === 'withComments' ? currentCode : "",
        codeNoComments: codeMode === 'noComments' ? currentCode : "",
        answer: document.getElementById("answerInput").value,
        image: document.getElementById("taskImage").src || "",
        text: taskTextGlobal,
        video: document.getElementById("videoUrl").value,
        fileUrl: fileUrl || "",
        solved: document.getElementById("solvedCheckbox").checked,
        favorite: false
    };

    tasks.push(taskData);
    current = tasks.length - 1;
    currentTaskData = taskData;
    updateTaskList();
    updateTaskInfoPanel();
    closeSaveDialog();
}

/* ================= –°–ü–ò–°–û–ö –ó–ê–î–ê–ß ================= */
function updateTaskList() {
    const container = document.getElementById("taskListItems");
    container.innerHTML = "";
    
    let filteredTasks = tasks;
    
    if (currentFilter === 'solved') {
        filteredTasks = tasks.filter(t => t.solved);
    } else if (currentFilter === 'unsolved') {
        filteredTasks = tasks.filter(t => !t.solved);
    } else if (currentFilter === 'favorite') {
        filteredTasks = tasks.filter(t => t.favorite);
    } else if (currentFilter === 'unfavorite') {
        filteredTasks = tasks.filter(t => !t.favorite);
    }
    
    filteredTasks.forEach((task, idx) => {
        const realIndex = tasks.indexOf(task);
        const div = document.createElement("div");
        div.className = `task-list-item ${current === realIndex ? 'selected' : ''}`;
        
        div.innerHTML = `
            <input type="checkbox" ${task.solved ? 'checked' : ''} onchange="toggleSolved(${realIndex}, this.checked)">
            <span class="task-star ${task.favorite ? 'favorite' : ''}" onclick="toggleFavorite(${realIndex}, event)">${task.favorite ? '‚òÖ' : '‚òÜ'}</span>
            <span class="task-title" onclick="showTask(${realIndex})">${realIndex + 1}. ${task.name}</span>
            <span class="task-status ${task.solved ? 'solved' : 'unsolved'}">${task.solved ? '‚úÖ' : '‚è≥'}</span>
        `;
        
        container.appendChild(div);
    });
}

function toggleSolved(index, checked) {
    if (tasks[index]) {
        tasks[index].solved = checked;
        if (current === index) {
            document.getElementById("solvedCheckbox").checked = checked;
            updateSolvedCheckbox();
        }
        updateTaskList();
        if (current === index) updateTaskInfoPanel();
    }
}

function toggleFavorite(index, event) {
    event.stopPropagation();
    if (tasks[index]) {
        tasks[index].favorite = !tasks[index].favorite;
        updateTaskList();
    }
}

function filterTaskList(filter) {
    currentFilter = filter;
    
    document.querySelectorAll('.task-list-header button').forEach(btn => {
        btn.classList.remove('active');
    });
    
    if (filter === 'all') document.getElementById('filterAllBtn').classList.add('active');
    if (filter === 'solved') document.getElementById('filterSolvedBtn').classList.add('active');
    if (filter === 'unsolved') document.getElementById('filterUnsolvedBtn').classList.add('active');
    if (filter === 'favorite') document.getElementById('filterFavoriteBtn').classList.add('active');
    if (filter === 'unfavorite') document.getElementById('filterUnfavoriteBtn').classList.add('active');
    
    updateTaskList();
}

function exportTasks() {
    if (tasks.length === 0) {
        alert("–ù–µ—Ç –∑–∞–¥–∞—á –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞!");
        return;
    }
    const blob = new Blob([JSON.stringify(tasks, null, 2)], { type: "application/json" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "tasks.json";
    a.click();
}

function importTasks() {
    if (tasks.length > 0) {
        showConfirm("–£ –≤–∞—Å –µ—Å—Ç—å –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏. –°–¥–µ–ª–∞–π—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –Ω–æ–≤—ã—Ö. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É? (—Å—Ç–∞—Ä—ã–µ –∑–∞–¥–∞—á–∏ –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã)", () => {
            document.getElementById("importFile").click();
        });
    } else {
        document.getElementById("importFile").click();
    }
}

document.getElementById("importFile").onchange = () => {
    const r = new FileReader();
    r.onload = () => {
        try {
            const importedTasks = JSON.parse(r.result);
            importedTasks.forEach(task => {
                if (task.favorite === undefined) task.favorite = false;
                if (task.fileUrl === undefined) task.fileUrl = "";
                if (task.codeWithComments === undefined) task.codeWithComments = task.code || "";
                if (task.codeNoComments === undefined) task.codeNoComments = task.code || "";
            });
            
            // –ó–∞–º–µ–Ω—è–µ–º —Å—Ç–∞—Ä—ã–µ –∑–∞–¥–∞—á–∏ –Ω–æ–≤—ã–º–∏
            tasks = importedTasks;
            
            reorganizeTasksAfterImport();
            if (tasks.length > 0) {
                showTask(0);
            }
            updateTaskList();
            alert(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${importedTasks.length} –∑–∞–¥–∞—á!`);
        } catch (e) {
            alert("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞: " + e.message);
        }
    };
    r.readAsText(document.getElementById("importFile").files[0]);
};

/* ================= –ó–ê–ì–†–£–ó–ö–ê –ó–ê–î–ê–ß –° GITHUB ================= */
async function loadGithubTask() {
    const select = document.getElementById('githubTaskSelect');
    const url = select.value;
    
    if (!url) {
        alert('–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞—á—É –∏–∑ —Å–ø–∏—Å–∫–∞!');
        return;
    }
    
    if (tasks.length > 0) {
        showConfirm("–£ –≤–∞—Å –µ—Å—Ç—å –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏. –°–¥–µ–ª–∞–π—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –Ω–æ–≤—ã—Ö. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É? (—Å—Ç–∞—Ä—ã–µ –∑–∞–¥–∞—á–∏ –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã)", async () => {
            await fetchGithubTask(url);
        });
    } else {
        await fetchGithubTask(url);
    }
}

async function fetchGithubTask(url) {
    const output = document.getElementById('output');
    output.innerHTML = `‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á–∏ —Å GitHub...`;
    
    try {
        const response = await fetch(url);
        
        if (!response.ok) {
            throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${response.status} ${response.statusText}`);
        }
        
        const importedTasks = await response.json();
        
        importedTasks.forEach(task => {
            if (task.favorite === undefined) task.favorite = false;
            if (task.fileUrl === undefined) task.fileUrl = "";
            if (task.codeWithComments === undefined) task.codeWithComments = task.code || "";
            if (task.codeNoComments === undefined) task.codeNoComments = task.code || "";
        });
        
        tasks = importedTasks;
        
        reorganizeTasksAfterImport();
        if (tasks.length > 0) {
            showTask(0);
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å —Ñ–∞–π–ª –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏, –∑–∞–≥—Ä—É–∂–∞–µ–º –µ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
            if (tasks[0].fileUrl) {
                output.innerHTML += `\n\n‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –¥–∞–Ω–Ω—ã—Ö...`;
                const fileResponse = await fetch(tasks[0].fileUrl);
                if (fileResponse.ok) {
                    loadedFileContent = await fileResponse.text();
                    output.innerHTML += `\n‚úÖ –§–∞–π–ª –¥–∞–Ω–Ω—ã—Ö –∑–∞–≥—Ä—É–∂–µ–Ω!`;
                }
            }
        }
        updateTaskList();
        output.innerHTML = `‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${importedTasks.length} –∑–∞–¥–∞—á!`;
        
    } catch (e) {
        output.innerHTML = `‚ùå –û—à–∏–±–∫–∞: ${e.message}`;
        output.className = "error";
    }
}

/* ================= –î–ò–ê–õ–û–ì –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø ================= */
function showConfirm(message, onYes) {
    const dialog = document.getElementById('confirmDialog');
    const messageEl = document.getElementById('confirmMessage');
    const yesBtn = document.getElementById('confirmYes');
    const noBtn = document.getElementById('confirmNo');
    
    messageEl.textContent = message;
    dialog.classList.add('show');
    
    const onYesHandler = () => {
        dialog.classList.remove('show');
        yesBtn.removeEventListener('click', onYesHandler);
        noBtn.removeEventListener('click', onNoHandler);
        onYes();
    };
    
    const onNoHandler = () => {
        dialog.classList.remove('show');
        yesBtn.removeEventListener('click', onYesHandler);
        noBtn.removeEventListener('click', onNoHandler);
    };
    
    yesBtn.addEventListener('click', onYesHandler);
    noBtn.addEventListener('click', onNoHandler);
}

/* ================= –ì–û–†–Ø–ß–ò–ï –ö–õ–ê–í–ò–®–ò ================= */
document.addEventListener("keydown", e => {
    if (e.key === "Escape") {
        if (drawEnabled) {
            drawEnabled = false;
            canvas.style.pointerEvents = "none";
            document.querySelectorAll('.color-btn, .pen-size-btn').forEach(btn => btn.classList.remove('drawing'));
        }
        if (document.getElementById("videoModal").classList.contains("show")) {
            closeVideoModal();
        }
        closePrintDialog();
        closeSaveDialog();
        closeProgrammerModal();
        closeFileLoadModal();
        
        if (animationActive) {
            stopAnimation();
            document.getElementById('output').innerHTML += '\n\n‚è∏Ô∏è –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ';
        }
    }
    if (e.ctrlKey && e.key === 'p') {
        e.preventDefault();
        showPrintDialog();
    }
    if (e.ctrlKey && e.key === 's') {
        e.preventDefault();
        showSaveDialog();
    }
});
</script>

</body>
</html>