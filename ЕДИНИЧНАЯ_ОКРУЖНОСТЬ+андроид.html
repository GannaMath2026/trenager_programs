<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>üåÄ –ï–¥–∏–Ω–∏—á–Ω–∞—è –æ–∫—Ä—É–∂–Ω–æ—Å—Ç—å ‚Äî sin/cos/tg/ctg</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body { 
            background: linear-gradient(135deg, #0a0a23, #1a1a3e, #16213e); 
            color: #ffdd44; 
            font-family: 'Segoe UI', Arial; 
            margin: 0; 
            padding: 15px; 
            min-height: 100vh;
            font-weight: bold;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
        }
        
        h1 {
            text-align: center; 
            font-size: 28px; 
            text-shadow: 0 0 20px #aa00ff;
            margin-bottom: 15px;
            padding: 10px 0;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .main-container {
            display: flex; 
            flex-direction: column;
            gap: 15px; 
            width: 100%;
            max-width: 1400px; 
            margin: 0 auto; 
            align-items: center;
            flex: 1;
        }
        
        /* –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è */
        @media (orientation: landscape) {
            .main-container {
                flex-direction: row;
                align-items: flex-start;
                height: calc(100vh - 100px);
            }
            
            h1 {
                font-size: 24px;
                margin-bottom: 10px;
                padding: 5px 0;
            }
            
            .canvas-container {
                flex: 1;
                order: 2;
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .controls {
                flex: 0 0 280px;
                order: 1;
                height: 100%;
                overflow-y: auto;
            }
            
            .result {
                flex: 0 0 350px;
                order: 3;
                height: 100%;
                overflow-y: auto;
            }
        }
        
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–∞–Ω–≤–∞—Å–∞ */
        .canvas-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        canvas { 
            border: 3px solid #aa00ff; 
            background: radial-gradient(circle, #1a1a1a, #000000); 
            box-shadow: 0 0 40px #aa00ff;
            border-radius: 15px; 
            cursor: grab;
            touch-action: none;
            display: block;
            max-width: 100%;
            max-height: 100%;
        }
        
        canvas:active { cursor: grabbing; }
        
        .controls { 
            background: rgba(170,0,255,0.1); 
            padding: 15px; 
            border-radius: 12px; 
            border: 2px solid #aa00ff; 
            width: 100%;
            max-width: 300px;
            backdrop-filter: blur(10px);
        }
        
        .result { 
            font-size: 16px; 
            padding: 15px; 
            border: 2px solid #667eea; 
            border-radius: 12px;
            background: rgba(102, 126, 234, 0.12); 
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.4);
            width: 100%;
            max-width: 350px;
            backdrop-filter: blur(15px);
        }
        
        /* –î–ª—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ */
        @media (orientation: portrait) {
            .main-container {
                min-height: calc(100vh - 150px);
            }
            
            canvas {
                max-height: 60vh;
            }
            
            .controls, .result {
                max-width: 100%;
            }
            
            h1 {
                font-size: 24px;
            }
        }
        
        /* –î–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            h1 {
                font-size: 22px;
                margin-bottom: 10px;
            }
            
            .controls, .result {
                padding: 12px;
            }
            
            .value-main {
                font-size: 18px;
            }
            
            .value-related {
                font-size: 16px;
            }
            
            @media (orientation: landscape) {
                .controls {
                    flex: 0 0 220px;
                }
                
                .result {
                    flex: 0 0 280px;
                }
            }
        }
        
        /* –î–ª—è –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
        @media (min-width: 1200px) {
            .canvas-container {
                max-width: 600px;
            }
        }
        
        input, button { 
            font-size: 16px; 
            padding: 12px; 
            width: 100%;
            border: 2px solid #aa00ff; 
            border-radius: 10px;
            background: rgba(170,0,255,0.2); 
            color: #ffdd44;
            margin: 8px 0; 
            font-weight: bold;
        }
        
        button:hover, button:active { 
            background: rgba(170,0,255,0.4); 
            box-shadow: 0 0 15px #aa00ff; 
        }
        
        .quadrant-btns {
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 8px; 
            margin: 12px 0;
        }
        
        .quadrant-btn { 
            background: rgba(102,126,234,0.3); 
            border-color: #667eea; 
            font-size: 14px; 
            padding: 10px;
        }
        
        .quadrant-btn.active { 
            background: rgba(102,126,234,0.6); 
            box-shadow: 0 0 12px #667eea; 
        }
        
        .value-main { 
            font-size: 18px; 
            color: #ff69b4; 
            margin: 8px 0; 
        }
        
        .value-related { 
            font-size: 16px; 
            color: #00ff88; 
            margin: 8px 0; 
        }
        
        .quadrant-angle { 
            font-size: 15px; 
            color: #ffaa88; 
            margin: 12px 0 8px; 
            font-weight: bold; 
        }
        
        .function-group { 
            margin: 12px 0; 
            padding: 10px; 
            background: rgba(255,255,255,0.05); 
            border-radius: 8px; 
        }
        
        .nonexistent { 
            font-size: 16px; 
            color: #ff4444; 
            font-weight: bold; 
            margin: 8px 0; 
            text-shadow: 0 0 8px #ff4444;
        }
        
        label { 
            display: block; 
            margin: 8px 0 5px; 
            font-size: 15px; 
        }
        
        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ */
        .debug-info {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px;
            font-size: 12px;
            border-radius: 5px;
            z-index: 1000;
            display: none;
        }
    </style>
</head>
<body>
    <div class="debug-info" id="debugInfo"></div>
    
    <h1>üéØ –ï–¥–∏–Ω–∏—á–Ω–∞—è –æ–∫—Ä—É–∂–Ω–æ—Å—Ç—å ‚Äî sin/cos/tg/ctg</h1>
    
    <div class="main-container">
        <div class="controls">
            <label>–£–≥–æ–ª (–≥—Ä–∞–¥—É—Å—ã):</label>
            <input type="range" id="angleSlider" min="0" max="360" value="135" step="1">
            <div class="value-main" id="angleValue">135¬∞</div>
            
            <div class="quadrant-btns">
                <button class="quadrant-btn" onclick="setQuadrant(1)">üìç I</button>
                <button class="quadrant-btn" onclick="setQuadrant(2)">üìç II</button>
                <button class="quadrant-btn" onclick="setQuadrant(3)">üìç III</button>
                <button class="quadrant-btn" onclick="setQuadrant(4)">üìç IV</button>
            </div>
            
            <button onclick="snapToStandard()">üìç –û—Å–Ω–æ–≤–Ω—ã–µ —É–≥–ª—ã</button>
            <button onclick="resetAngle()">üîÑ –°–±—Ä–æ—Å 0¬∞</button>
        </div>
        
        <div class="canvas-container">
            <canvas id="unitCircle"></canvas>
        </div>
        
        <div class="result" id="functions">
            –ü–µ—Ä–µ—Ç–∞—â–∏ —Ä–∞–¥–∏—É—Å-–≤–µ–∫—Ç–æ—Ä!
        </div>
    </div>

    <script>
        const canvas = document.getElementById('unitCircle');
        const ctx = canvas.getContext('2d');
        const debugInfo = document.getElementById('debugInfo');
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤
        let canvasSize = 400; // –Ω–∞—á–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä
        let centerX, centerY, radius;
        
        let currentAngle = 135;
        let isDragging = false;
        let currentQuadrant = 2;
        let touchId = null; // –î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–∞—Å–∞–Ω–∏—è

        const standardAngles = [0, 30, 45, 60, 90, 120, 135, 150, 180, 210, 225, 240, 270, 300, 315, 330, 360];

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ –∫–∞–Ω–≤–∞—Å–∞
        function updateCanvasSize() {
            const container = canvas.parentElement;
            const containerWidth = container.clientWidth;
            const containerHeight = container.clientHeight;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–∑–º–µ—Ä –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
            if (window.innerWidth > window.innerHeight) {
                // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è
                canvasSize = Math.min(containerWidth * 0.8, containerHeight * 0.9, 500);
            } else {
                // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è
                canvasSize = Math.min(containerWidth * 0.95, containerHeight * 0.6, 450);
            }
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä
            canvasSize = Math.max(canvasSize, 250);
            canvasSize = Math.min(canvasSize, 600);
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã –∫–∞–Ω–≤–∞—Å–∞
            canvas.width = canvasSize;
            canvas.height = canvasSize;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–Ω—Ç—Ä –∏ —Ä–∞–¥–∏—É—Å
            centerX = canvas.width / 2;
            centerY = canvas.height / 2;
            radius = canvasSize * 0.35;
            
            // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            debugInfo.innerHTML = `
                –†–∞–∑–º–µ—Ä: ${canvas.width}x${canvas.height}<br>
                –û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è: ${window.innerWidth > window.innerHeight ? '–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è' : '–≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è'}<br>
                –¶–µ–Ω—Ç—Ä: ${centerX}, ${centerY}<br>
                –†–∞–¥–∏—É—Å: ${radius}
            `;
            
            // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º
            draw();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ä–∞–∑–º–µ—Ä–∞
        window.addEventListener('load', updateCanvasSize);
        window.addEventListener('resize', updateCanvasSize);
        window.addEventListener('orientationchange', function() {
            // –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º, —á—Ç–æ–±—ã –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è —É—Å–ø–µ–ª–∞ –∏–∑–º–µ–Ω–∏—Ç—å—Å—è
            setTimeout(updateCanvasSize, 100);
        });

        function getQuadrantInfo(angleDeg) {
            const normAngle = angleDeg % 360;
            if (normAngle < 90) return { quadrant: 1, relatedAngle: null, formula: '' };
            if (normAngle < 180) return { quadrant: 2, relatedAngle: 180 - normAngle, formula: `180¬∞ - ${normAngle.toFixed(0)}¬∞` };
            if (normAngle < 270) return { quadrant: 3, relatedAngle: normAngle - 180, formula: `${normAngle.toFixed(0)}¬∞ - 180¬∞` };
            return { quadrant: 4, relatedAngle: 360 - normAngle, formula: `360¬∞ - ${normAngle.toFixed(0)}¬∞` };
        }

        function setQuadrant(q) {
            currentQuadrant = q;
            
            const quadrantInfo = getQuadrantInfo(currentAngle);
            let referenceAngle = quadrantInfo.relatedAngle !== null ? quadrantInfo.relatedAngle : (currentAngle % 90);
            
            const quadrantAngles = {
                1: referenceAngle,
                2: 180 - referenceAngle,
                3: 180 + referenceAngle,
                4: 360 - referenceAngle
            };
            
            currentAngle = quadrantAngles[q];
            
            document.querySelectorAll('.quadrant-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            draw();
        }

        function sinValue(deg) { return Math.sin(deg * Math.PI / 180).toFixed(3); }
        function cosValue(deg) { return Math.cos(deg * Math.PI / 180).toFixed(3); }
        
        function tgValue(deg) { 
            const radians = deg * Math.PI / 180;
            const cosVal = Math.cos(radians);
            if (Math.abs(cosVal) < 1e-10) return '–Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç';
            const tan = Math.sin(radians) / cosVal;
            return tan.toFixed(3);
        }
        
        function ctgValue(deg) { 
            const radians = deg * Math.PI / 180;
            const sinVal = Math.sin(radians);
            if (Math.abs(sinVal) < 1e-10) return '–Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç';
            const cot = Math.cos(radians) / sinVal;
            return cot.toFixed(3);
        }

        function draw() {
            if (!ctx || canvas.width === 0 || canvas.height === 0) {
                console.error('Canvas –Ω–µ –≥–æ—Ç–æ–≤ –∫ –æ—Ç—Ä–∏—Å–æ–≤–∫–µ');
                return;
            }
            
            // –û—á–∏—â–∞–µ–º –∫–∞–Ω–≤–∞—Å
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ü–µ–Ω—Ç—Ä –∏ —Ä–∞–¥–∏—É—Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
            if (!centerX || !centerY || !radius) {
                updateCanvasSize();
                return;
            }

            // –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã
            const baseFontSize = Math.max(12, canvasSize / 35);
            const labelFontSize = Math.max(10, canvasSize / 45);
            const angleFontSize = Math.max(14, canvasSize / 30);
            const pointRadius = Math.max(8, canvasSize / 60);

            // –û–∫—Ä—É–∂–Ω–æ—Å—Ç—å
            ctx.beginPath(); 
            ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
            ctx.strokeStyle = '#aa00ff'; 
            ctx.lineWidth = 3; 
            ctx.shadowColor = '#aa00ff'; 
            ctx.shadowBlur = 15; 
            ctx.stroke();

            // –û–°–ò sin/cos
            ctx.strokeStyle = '#ffdd44'; 
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(centerX - radius * 1.2, centerY); 
            ctx.lineTo(centerX + radius * 1.2, centerY);
            ctx.moveTo(centerX, centerY - radius * 1.2); 
            ctx.lineTo(centerX, centerY + radius * 1.2);
            ctx.stroke();

            // –§–ò–ö–°–ò–†–û–í–ê–ù–ù–´–ï –£–ì–õ–´ (—Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã–µ)
            ctx.fillStyle = '#ffffff'; 
            ctx.font = `bold ${baseFontSize}px Arial`; 
            ctx.textAlign = 'center'; 
            ctx.textBaseline = 'middle';
            ctx.shadowColor = '#ffffff'; 
            ctx.shadowBlur = 5;
            
            const keyAngles = [0, 30, 45, 60, 90, 120, 135, 150, 180, 210, 225, 240, 270, 300, 315, 330, 360];
            keyAngles.forEach(angle => {
                const rad = angle * Math.PI / 180;
                const labelRadius = radius + 20;
                const x = centerX + labelRadius * Math.cos(rad);
                const y = centerY - labelRadius * Math.sin(rad);
                ctx.fillText(`${angle}¬∞`, x, y);
            });
            ctx.shadowBlur = 0;

            // –û–°–ò tg/ctg
            ctx.lineWidth = 1.5;
            ctx.strokeStyle = '#ffaa00'; 
            ctx.setLineDash([4, 4]);
            ctx.beginPath();
            ctx.moveTo(centerX + radius, centerY - radius); 
            ctx.lineTo(centerX + radius, centerY + radius);
            ctx.stroke();

            ctx.strokeStyle = '#00ff88'; 
            ctx.beginPath();
            ctx.moveTo(centerX - radius, centerY - radius); 
            ctx.lineTo(centerX + radius, centerY - radius);
            ctx.stroke();
            ctx.setLineDash([]);

            const quadrantInfo = getQuadrantInfo(currentAngle);
            const mainRad = currentAngle * Math.PI / 180;
            const mainEndX = centerX + radius * Math.cos(mainRad);
            const mainEndY = centerY - radius * Math.sin(mainRad);

            // –õ–£–ß–ò
            ctx.lineWidth = 1; 
            ctx.strokeStyle = '#ffaa00'; 
            ctx.setLineDash([3, 3]);
            ctx.beginPath();
            const rayLength = radius * 1.5;
            ctx.moveTo(centerX + rayLength * Math.cos(mainRad), centerY - rayLength * Math.sin(mainRad));
            ctx.lineTo(centerX - rayLength * Math.cos(mainRad), centerY + rayLength * Math.sin(mainRad));
            ctx.stroke();
            ctx.setLineDash([]);

            // –†–ê–î–ò–£–°-–í–ï–ö–¢–û–†
            ctx.lineWidth = 4; 
            ctx.strokeStyle = '#ff69b4'; 
            ctx.setLineDash([6, 6]);
            ctx.beginPath(); 
            ctx.moveTo(centerX, centerY); 
            ctx.lineTo(mainEndX, mainEndY); 
            ctx.stroke();
            ctx.setLineDash([]);

            // –¢–æ—á–∫–∞ –Ω–∞ –æ–∫—Ä—É–∂–Ω–æ—Å—Ç–∏
            ctx.beginPath(); 
            ctx.arc(mainEndX, mainEndY, pointRadius, 0, 2 * Math.PI);
            ctx.fillStyle = '#ff69b4'; 
            ctx.shadowColor = '#ff69b4'; 
            ctx.shadowBlur = 20; 
            ctx.fill();
            ctx.strokeStyle = '#ff1493'; 
            ctx.lineWidth = 2; 
            ctx.stroke();

            // –ü–£–ù–ö–¢–ò–†–´ –ö sin/cos
            ctx.lineWidth = 1.5; 
            ctx.strokeStyle = '#ff69b4'; 
            ctx.setLineDash([5, 5]);
            ctx.beginPath(); 
            ctx.moveTo(mainEndX, mainEndY); 
            ctx.lineTo(centerX, mainEndY); 
            ctx.stroke();
            ctx.beginPath(); 
            ctx.moveTo(mainEndX, mainEndY); 
            ctx.lineTo(mainEndX, centerY); 
            ctx.stroke();
            ctx.setLineDash([]);

            // –ü–æ–¥–ø–∏—Å–∏ —Ñ—É–Ω–∫—Ü–∏–π
            ctx.font = `bold ${labelFontSize}px Arial`; 
            ctx.textAlign = 'center'; 
            ctx.textBaseline = 'middle';
            
            // sin
            ctx.fillStyle = '#ffdd44'; 
            ctx.shadowColor = '#ffdd44'; 
            ctx.shadowBlur = 8;
            ctx.save();
            ctx.translate(centerX - 18, mainEndY); 
            ctx.rotate(-Math.PI/2); 
            ctx.fillText('sin', 0, 0); 
            ctx.restore();
            
            // cos  
            ctx.fillText('cos', mainEndX, centerY + 18);
            
            // –ü–æ–¥–ø–∏—Å–∏ —É–≥–ª–æ–≤
            ctx.fillStyle = '#ffdd44'; 
            ctx.font = `bold ${angleFontSize}px Arial`;
            const labelDistance = radius * 0.6;
            const mainAngleX = mainEndX - labelDistance * Math.cos(mainRad);
            const mainAngleY = mainEndY + labelDistance * Math.sin(mainRad);
            ctx.fillText(`${currentAngle.toFixed(0)}¬∞`, mainAngleX, mainAngleY);

            updateFunctions(quadrantInfo);
        }

        function updateFunctions(quadrantInfo) {
            const sinMain = sinValue(currentAngle);
            const cosMain = cosValue(currentAngle);
            const tgMain = tgValue(currentAngle);
            const ctgMain = ctgValue(currentAngle);

            let html = `
                <div class="function-group">
                    <div style="font-size: 16px; color: #ffdd44; margin-bottom: 10px;">üî¥ ${currentAngle.toFixed(0)}¬∞ (–ö–≤–∞–¥—Ä–∞–Ω—Ç ${quadrantInfo.quadrant})</div>
                    <div class="value-main">sin ${currentAngle.toFixed(0)}¬∞ = ${sinMain}</div>
                    <div class="value-main">cos ${currentAngle.toFixed(0)}¬∞ = ${cosMain}</div>
            `;

            if (tgMain === '–Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç') {
                html += `<div class="nonexistent">tg ${currentAngle.toFixed(0)}¬∞ = –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç</div>`;
            } else {
                html += `<div class="value-main">tg ${currentAngle.toFixed(0)}¬∞ = ${tgMain}</div>`;
            }

            if (ctgMain === '–Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç') {
                html += `<div class="nonexistent">ctg ${currentAngle.toFixed(0)}¬∞ = –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç</div>`;
            } else {
                html += `<div class="value-main">ctg ${currentAngle.toFixed(0)}¬∞ = ${ctgMain}</div>`;
            }

            html += `</div>`;

            if (quadrantInfo.relatedAngle !== null) {
                const sinRel = sinValue(quadrantInfo.relatedAngle);
                const cosRel = cosValue(quadrantInfo.relatedAngle);
                const tgRel = tgValue(quadrantInfo.relatedAngle);
                const ctgRel = ctgValue(quadrantInfo.relatedAngle);
                
                html += `
                    <div class="function-group">
                        <div class="quadrant-angle">üü¢ ${quadrantInfo.formula} = ${quadrantInfo.relatedAngle.toFixed(0)}¬∞</div>
                        <div class="value-related">sin ${quadrantInfo.relatedAngle.toFixed(0)}¬∞ = ${sinRel}</div>
                        <div class="value-related">cos ${quadrantInfo.relatedAngle.toFixed(0)}¬∞ = ${cosRel}</div>
                `;

                if (tgRel === '–Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç') {
                    html += `<div class="value-related nonexistent">tg ${quadrantInfo.relatedAngle.toFixed(0)}¬∞ = –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç</div>`;
                } else {
                    html += `<div class="value-related">tg ${quadrantInfo.relatedAngle.toFixed(0)}¬∞ = ${tgRel}</div>`;
                }

                if (ctgRel === '–Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç') {
                    html += `<div class="value-related nonexistent">ctg ${quadrantInfo.relatedAngle.toFixed(0)}¬∞ = –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç</div>`;
                } else {
                    html += `<div class="value-related">ctg ${quadrantInfo.relatedAngle.toFixed(0)}¬∞ = ${ctgRel}</div>`;
                }

                html += `</div>`;
            }

            document.getElementById('functions').innerHTML = html;
            document.getElementById('angleValue').textContent = `${currentAngle.toFixed(0)}¬∞`;
            document.getElementById('angleSlider').value = currentAngle;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —Å —É—á—ë—Ç–æ–º –º–∞—Å—à—Ç–∞–±–∞ –∫–∞–Ω–≤–∞—Å–∞
        function getCanvasCoordinates(clientX, clientY) {
            const rect = canvas.getBoundingClientRect();
            
            // –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É —Ä–∞–∑–º–µ—Ä—É –∫–∞–Ω–≤–∞—Å–∞
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            
            const x = (clientX - rect.left) * scaleX;
            const y = (clientY - rect.top) * scaleY;
            
            return { x, y };
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º—ã—à–∏
        canvas.addEventListener('mousedown', (e) => {
            e.preventDefault();
            const { x, y } = getCanvasCoordinates(e.clientX, e.clientY);
            const dist = Math.sqrt((x - centerX) ** 2 + (y - centerY) ** 2);
            
            if (dist > radius - 20 && dist < radius + 20) {
                isDragging = true;
                canvas.style.cursor = 'grabbing';
                
                // –°—Ä–∞–∑—É –æ–±–Ω–æ–≤–ª—è–µ–º —É–≥–æ–ª
                const dx = x - centerX;
                const dy = y - centerY;
                currentAngle = (Math.atan2(-dy, dx) * 180 / Math.PI + 360) % 360;
                draw();
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            e.preventDefault();
            
            const { x, y } = getCanvasCoordinates(e.clientX, e.clientY);
            const dx = x - centerX;
            const dy = y - centerY;
            currentAngle = (Math.atan2(-dy, dx) * 180 / Math.PI + 360) % 360;
            draw();
        });

        canvas.addEventListener('mouseup', () => {
            isDragging = false;
            canvas.style.cursor = 'grab';
        });

        canvas.addEventListener('mouseleave', () => {
            isDragging = false;
            canvas.style.cursor = 'grab';
        });

        // –£–ü–†–û–©–ï–ù–ù–´–ï –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è touch-—Å–æ–±—ã—Ç–∏–π
        canvas.addEventListener('touchstart', handleTouchStart, { passive: false });
        canvas.addEventListener('touchmove', handleTouchMove, { passive: false });
        canvas.addEventListener('touchend', handleTouchEnd);
        canvas.addEventListener('touchcancel', handleTouchEnd);

        function handleTouchStart(e) {
            e.preventDefault();
            if (e.touches.length === 1) {
                const touch = e.touches[0];
                const { x, y } = getCanvasCoordinates(touch.clientX, touch.clientY);
                const dist = Math.sqrt((x - centerX) ** 2 + (y - centerY) ** 2);
                
                if (dist > radius - 30 && dist < radius + 30) {
                    isDragging = true;
                    touchId = touch.identifier;
                    
                    // –°—Ä–∞–∑—É –æ–±–Ω–æ–≤–ª—è–µ–º —É–≥–æ–ª
                    const dx = x - centerX;
                    const dy = y - centerY;
                    currentAngle = (Math.atan2(-dy, dx) * 180 / Math.PI + 360) % 360;
                    draw();
                }
            }
        }

        function handleTouchMove(e) {
            if (!isDragging) return;
            e.preventDefault();
            
            // –ù–∞—Ö–æ–¥–∏–º –Ω–∞—à touch
            for (let i = 0; i < e.touches.length; i++) {
                const touch = e.touches[i];
                if (touch.identifier === touchId) {
                    const { x, y } = getCanvasCoordinates(touch.clientX, touch.clientY);
                    const dx = x - centerX;
                    const dy = y - centerY;
                    currentAngle = (Math.atan2(-dy, dx) * 180 / Math.PI + 360) % 360;
                    draw();
                    break;
                }
            }
        }

        function handleTouchEnd(e) {
            isDragging = false;
            touchId = null;
        }

        // –°–ª–∞–π–¥–µ—Ä
        document.getElementById('angleSlider').addEventListener('input', (e) => {
            currentAngle = parseFloat(e.target.value);
            draw();
        });

        function snapToStandard() {
            const closest = standardAngles.reduce((prev, curr) => 
                Math.abs(curr - currentAngle) < Math.abs(prev - currentAngle) ? curr : prev
            );
            currentAngle = closest;
            draw();
        }

        function resetAngle() {
            currentAngle = 0;
            draw();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        updateCanvasSize();
    </script>
</body>
</html>